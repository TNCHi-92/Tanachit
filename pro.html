<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏° - Snack Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <span class="login-logo-icon">üç™</span>
                <h2>Snack Tracker</h2>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏°</p>
            </div>

            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <button class="login-tab" onclick="switchLoginTab('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</button>
            </div>

            <!-- Login Form -->
            <div id="loginMessage" class="login-message"></div>

            <div id="loginForm" class="login-form">
                <input type="text" id="loginNameInput" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" onkeydown="if(event.key==='Enter')loginUser()">
                <button class="btn btn-primary" onclick="loginUser()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="login-form" style="display: none;">
                <input type="text" id="registerDisplayName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡∏ò‡∏ô‡∏ä‡∏¥‡∏ï)" onkeydown="if(event.key==='Enter')document.getElementById('registerAliases').focus()">
                <input type="text" id="registerAliases" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ , (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏¥‡∏ï, chit)" onkeydown="if(event.key==='Enter')registerUser()">
                <span class="login-hint">* ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ login ‡πÑ‡∏î‡πâ ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ,</span>
                <button class="btn btn-secondary" onclick="registerUser()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>üç™ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏°</h1>
            <div class="header-info">
                <div class="user-greeting" id="userGreeting">
                    <span class="user-greeting-name" id="userGreetingName"></span>
                    <span class="user-role-badge" id="userRoleBadge"></span>
                    <button class="btn-logout" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <div class="date-display" id="currentDate"></div>
                <button class="btn btn-outline" id="manageBtn" onclick="showManageModal()">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn btn-secondary" onclick="showMonthlyReport()">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
            </div>
        </header>

        <div class="card">
            <h2 class="card-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h2>
            <div class="snack-groups" id="snackGrid"></div>

            <div class="summary-card">
                <div class="summary-title">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="summary-content">
                    <div class="summary-item">
                        <div class="summary-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="summary-value" id="todayCount">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
                        <div class="summary-value" id="todayTotal">0 ‡∏ø</div>
                    </div>
                </div>
                <div id="todayPurchaseList" style="margin-top: 20px;"></div>
            </div>

            <div class="ranking-card" id="rankingCard" style="display: none;">
                <div class="ranking-title">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                <div class="ranking-list" id="rankingList"></div>
            </div>
        </div>
    </div>

    <!-- Manage Modal -->
    <div class="modal" id="manageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <button class="close-btn" onclick="closeManageModal()">&times;</button>
            </div>

            <div class="manage-tabs">
                <button class="manage-tab active" data-tab="snacks" onclick="switchManageTab('snacks')">üç™ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button class="manage-tab" data-tab="customers" onclick="switchManageTab('customers')">üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
                <button class="manage-tab" data-tab="profit" onclick="switchManageTab('profit')">üìà ‡∏Å‡∏≥‡πÑ‡∏£</button>
            </div>

            <!-- Snacks Tab -->
            <div id="manageSnacksTab">
                <div class="manage-form">
                    <div class="image-upload-wrapper">
                        <input type="file" id="newSnackImage" accept="image/*" onchange="previewSnackImage(this)">
                        <div class="image-drop-zone" id="imageDropZone" onclick="document.getElementById('newSnackImage').click()" tabindex="0">
                            <span class="drop-icon">üì∑</span>
                            <span class="drop-text">‡∏ß‡∏≤‡∏á/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span>
                        </div>
                        <button type="button" class="btn-clipboard" onclick="pasteImageFromClipboard()">‡∏ß‡∏≤‡∏á‡∏à‡∏≤‡∏Å Ctrl+V</button>
                    </div>
                    <input type="text" id="newSnackName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <input type="number" id="newSnackPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" min="1" step="0.01" onblur="formatSnackMoneyInput('newSnackPrice')" style="max-width: 100px;">
                    <input type="number" id="newSnackCost" placeholder="‡∏ó‡∏∏‡∏ô" min="0" step="0.01" onblur="formatSnackMoneyInput('newSnackCost')" style="max-width: 100px;">
                    <select id="newSnackCategory" style="padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 0.95rem; min-width: 140px;">
                        <option value="snack">üç™ ‡∏Ç‡∏ô‡∏°</option>
                        <option value="ice_cream">üç¶ ‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô</option>
                    </select>
                    <input type="number" id="newSnackStock" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0" style="max-width: 100px;">
                    <button class="btn btn-primary" id="saveSnackBtn" onclick="addOrUpdateSnack()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    <button class="btn btn-outline" id="cancelEditSnackBtn" onclick="cancelEditSnack()" style="display: none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
                <div class="manage-list" id="manageSnackList" style="margin-top: 15px;"></div>
            </div>

            <!-- Customers Tab -->
            <div id="manageCustomersTab" style="display: none;">
                <div class="manage-form">
                    <input type="text" id="newCustomerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    <select id="newCustomerShift" style="padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 0.95rem; min-width: 120px;">
                        <option value="A">Shift A</option>
                        <option value="B">Shift B</option>
                        <option value="C">Shift C</option>
                        <option value="D">Shift D</option>
                        <option value="O">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                    <button class="btn btn-primary" onclick="addCustomer()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div class="manage-list" id="manageCustomerList" style="margin-top: 15px;"></div>
                <div class="card" style="margin-top: 15px; padding: 20px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 12px; color: var(--text-dark);">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h4>
                    <div id="manageUserRoleList" class="manage-list"></div>
                </div>
            </div>

            <!-- Profit Tab -->
            <div id="manageProfitTab" style="display: none;">
                <div class="manage-form" style="align-items: center;">
                    <label for="profitMonth" style="font-weight: 600; color: var(--text-dark);">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
                    <input type="month" id="profitMonth" onchange="renderProfitTab()">
                    <button class="btn btn-outline" onclick="renderProfitTab()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                </div>
                <div id="profitSummaryCards" class="stats-grid" style="margin-top: 15px;"></div>
                <div class="card" style="margin-top: 15px; padding: 20px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 12px; color: var(--text-dark);">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡πÑ‡∏£</h4>
                    <div id="profitProductList" class="customer-detail-list"></div>
                </div>
                <div class="card" style="margin-top: 15px; padding: 20px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 12px; color: var(--text-dark);">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏î‡∏µ (Top 5)</h4>
                    <div id="bestSellerList" class="customer-detail-list"></div>
                </div>
                <div class="card" style="margin-top: 15px; padding: 20px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 12px; color: var(--text-dark);">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏î‡∏µ (Top 5)</h4>
                    <div id="worstSellerList" class="customer-detail-list"></div>
                </div>
                <div class="card" style="margin-top: 15px; padding: 20px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 12px; color: var(--text-dark);">Audit Log</h4>
                    <div class="manage-form" style="margin-bottom: 12px;">
                        <input type="text" id="auditSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ actor/detail/action" oninput="renderProfitTab()">
                        <select id="auditActionFilter" onchange="renderProfitTab()" style="padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 0.95rem; min-width: 170px;">
                            <option value="">‡∏ó‡∏∏‡∏Å action</option>
                            <option value="sale.create">sale.create</option>
                            <option value="snack.create">snack.create</option>
                            <option value="snack.update">snack.update</option>
                            <option value="snack.price.change">snack.price.change</option>
                            <option value="snack.delete">snack.delete</option>
                            <option value="customer.create">customer.create</option>
                            <option value="customer.delete">customer.delete</option>
                            <option value="user.login">user.login</option>
                            <option value="user.logout">user.logout</option>
                            <option value="user.register">user.register</option>
                            <option value="user.role.update">user.role.update</option>
                        </select>
                        <select id="auditRoleFilter" onchange="renderProfitTab()" style="padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 0.95rem; min-width: 130px;">
                            <option value="">‡∏ó‡∏∏‡∏Å role</option>
                            <option value="admin">admin</option>
                            <option value="staff">staff</option>
                        </select>
                    </div>
                    <div id="auditLogList" class="customer-detail-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Select Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span id="selectedSnackEmoji"></span>
                    <span id="selectedSnackName"></span>
                </div>

                <button class="close-btn" onclick="closeCustomerModal()">&times;</button>
            </div>

            <div class="price-display">
                <div class="price-label">‡∏£‡∏≤‡∏Ñ‡∏≤</div>
                <div class="price-value"><span id="selectedSnackPrice"></span> ‡∏ö‡∏≤‡∏ó</div>
            </div>

            <div class="search-box">
                <input type="text" 
                       id="customerSearch" 
                       placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."
                       oninput="filterCustomers()">
            </div>

            <div class="shift-filter" id="shiftFilter">
                <button class="shift-btn active" onclick="filterShift('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="shift-btn" onclick="filterShift('A')">Shift A</button>
                <button class="shift-btn" onclick="filterShift('B')">Shift B</button>
                <button class="shift-btn" onclick="filterShift('C')">Shift C</button>
                <button class="shift-btn" onclick="filterShift('D')">Shift D</button>
                <button class="shift-btn" onclick="filterShift('O')">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</button>
            </div>

            <div class="customer-section-title">
                üìù ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
            </div>
            <div class="customer-grid" id="customerGrid"></div>

            <div id="confirmSection" style="display: none; margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--border);">
                <div style="text-align: center; margin-bottom: 12px; font-weight: 500; color: var(--text-dark);">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß <span id="selectedCount" style="color: var(--primary); font-weight: 700;">0</span> ‡∏Ñ‡∏ô
                </div>
                <button class="btn btn-primary" onclick="confirmPurchase()" style="width: 100%; padding: 16px; font-size: 1.1rem;">
                    ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- Monthly Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                <button class="close-btn" onclick="closeReportModal()">&times;</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-dark);">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ
                </label>
                <input type="month" 
                       id="reportMonth" 
                       onchange="generateReport()"
                       style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Prompt', sans-serif;">
            </div>

            <div id="reportContent"></div>
        </div>
    </div>
    <script src="assets/js/modules/core.js"></script>
    <script src="assets/js/modules/report.js"></script>
    <script src="assets/js/modules/manage.js"></script>
    <script src="assets/js/modules/bootstrap.js"></script>
</body>
</html>
