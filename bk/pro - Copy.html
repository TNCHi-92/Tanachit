<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏° - Snack Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B6B;
            --primary-dark: #E85555;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --bg-main: #F8F9FA;
            --bg-card: #FFFFFF;
            --text-dark: #2D3436;
            --text-light: #636E72;
            --border: #DFE6E9;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-hover: 0 8px 30px rgba(0,0,0,0.12);
            --success: #00B894;
            --warning: #FDCB6E;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255,107,107,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(78,205,196,0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 30px 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Mitr', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .header-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .date-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            box-shadow: 0 4px 15px rgba(78,205,196,0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78,205,196,0.4);
        }

        .btn-outline {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--border);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 30px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        .snack-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }

        .snack-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
            border: 3px solid var(--border);
            border-radius: 20px;
            padding: 25px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .snack-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .snack-item:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .snack-item:hover::before {
            transform: scaleX(1);
        }

        .snack-item:active {
            transform: translateY(-2px) scale(0.98);
        }

        .snack-emoji {
            font-size: 3rem;
            margin-bottom: 12px;
            display: block;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            animation: bounce 0.5s ease;
        }

        .snack-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 12px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .snack-item:hover .snack-img {
            animation: bounce 0.5s ease infinite;
        }

        .snack-img-preview {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 8px;
        }

        .snack-img-modal {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 10px;
        }

        .snack-img-mini {
            width: 24px;
            height: 24px;
            object-fit: cover;
            border-radius: 4px;
            vertical-align: middle;
        }

        .image-upload-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .image-upload-wrapper input[type="file"] {
            display: none;
        }

        .image-drop-zone {
            width: 80px;
            height: 52px;
            border: 2px dashed var(--border);
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-family: 'Prompt', sans-serif;
            font-size: 0.75rem;
            color: var(--text-light);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .image-drop-zone:hover, .image-drop-zone.drag-over {
            border-color: var(--primary);
            color: var(--primary);
            background: #FFF5F5;
        }

        .image-drop-zone.has-image {
            border-color: var(--success);
            border-style: solid;
            padding: 0;
        }

        .image-drop-zone.has-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .image-drop-zone .drop-icon {
            font-size: 1.2rem;
            line-height: 1;
        }

        .image-drop-zone .drop-text {
            font-size: 0.65rem;
            line-height: 1;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .snack-item:hover .snack-emoji {
            animation: bounce 0.5s ease infinite;
        }

        .snack-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-dark);
        }

        .snack-price {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 35px;
            max-width: 900px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: var(--bg-main);
            color: var(--primary);
            transform: rotate(90deg);
        }

        .price-display {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #FFF5F5, #FFE5E5);
            border-radius: 12px;
            border: 2px solid #FFD1D1;
        }

        .price-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .price-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Mitr', sans-serif;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }

        .customer-section-title {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .customer-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 5px;
        }

        .customer-btn {
            padding: 14px 16px;
            background: linear-gradient(135deg, #f5f7fa, #ffffff);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 1rem;
            text-align: center;
            font-family: 'Prompt', sans-serif;
        }

        .customer-btn:hover {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            border-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78,205,196,0.3);
        }

        .customer-btn.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
        }

        .customer-btn {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }

        .customer-btn.selected {
            justify-content: space-between;
            padding: 8px 10px;
        }

        .qty-btn {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .qty-btn-minus {
            background: rgba(255,255,255,0.4);
            color: white;
        }

        .qty-btn-minus:hover {
            background: rgba(255,255,255,0.7);
            color: var(--primary);
        }

        .qty-btn-plus {
            background: rgba(255,255,255,0.4);
            color: white;
        }

        .qty-btn-plus:hover {
            background: rgba(255,255,255,0.7);
            color: var(--success);
        }

        .qty-display {
            font-weight: 700;
            font-size: 1rem;
            min-width: 24px;
            text-align: center;
        }

        .shift-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .shift-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            font-family: 'Prompt', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shift-btn:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .shift-btn.active {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            border-color: var(--secondary);
        }

        .customer-name-label {
            flex: 1;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #00A077);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,184,148,0.4);
            z-index: 3000;
            animation: slideInFromRight 0.4s ease-out;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .summary-card {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
        }

        .summary-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .summary-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .summary-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Mitr', sans-serif;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 20px;
            border-radius: 16px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Mitr', sans-serif;
            color: var(--primary);
        }

        .customer-detail-list {
            margin-top: 20px;
        }

        .customer-detail-item {
            background: linear-gradient(to right, #f8f9fa, #ffffff);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            margin-bottom: 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .customer-detail-item:hover {
            background: linear-gradient(to right, #ffffff, #f8f9fa);
            transform: translateX(4px);
            box-shadow: var(--shadow);
        }

        .customer-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .customer-detail-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .customer-detail-total {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .customer-detail-info {
            color: var(--text-light);
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .qr-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            header {
                flex-direction: column;
                gap: 15px;
                padding: 20px;
            }

            .header-info {
                flex-direction: column;
                width: 100%;
            }

            .header-info .btn {
                width: 100%;
            }

            .snack-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }

            .snack-emoji {
                font-size: 2.5rem;
            }

            .snack-name {
                font-size: 0.95rem;
            }

            .card {
                padding: 20px;
            }

            .modal-content {
                padding: 25px 20px;
            }

            .summary-content {
                grid-template-columns: 1fr;
            }

            .customer-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            body {
                padding: 10px;
            }
        }

        .today-purchase-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 8px;
            backdrop-filter: blur(10px);
            font-size: 0.95rem;
        }

        .today-purchase-item .purchase-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .today-purchase-item .purchase-price {
            font-weight: 700;
            white-space: nowrap;
        }

        .today-purchase-item .purchase-time {
            opacity: 0.8;
            font-size: 0.8rem;
        }

        .today-purchase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .today-purchase-header span {
            font-weight: 600;
            font-size: 1rem;
        }

        .manage-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .manage-tab {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: white;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .manage-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }

        .manage-tab:not(.active):hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .manage-list {
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .manage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f5f7fa, #ffffff);
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .manage-item:hover {
            border-color: var(--primary);
        }

        .manage-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .manage-item-price {
            color: var(--primary);
            font-weight: 600;
        }

        .btn-delete {
            background: none;
            border: 2px solid #FFD1D1;
            border-radius: 8px;
            color: var(--primary);
            cursor: pointer;
            padding: 6px 12px;
            font-size: 0.85rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .manage-form {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa, #ffffff);
            border-radius: 16px;
            border: 2px solid var(--border);
        }

        .manage-form input {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .manage-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }

        .manage-form .btn {
            white-space: nowrap;
        }

        .snack-stock {
            font-size: 0.8rem;
            margin-top: 6px;
            padding: 3px 10px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 600;
        }

        .snack-stock.in-stock {
            background: #E8F8F5;
            color: var(--success);
        }

        .snack-stock.low-stock {
            background: #FFF8E1;
            color: #F39C12;
        }

        .snack-stock.out-of-stock {
            background: #FFE5E5;
            color: var(--primary);
        }

        .snack-item.sold-out {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.5);
        }

        .snack-item.sold-out::after {
            content: '‡∏´‡∏°‡∏î';
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 6px;
        }

        .ranking-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
        }

        .ranking-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 12px 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .ranking-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .ranking-badge.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .ranking-badge.silver { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); }
        .ranking-badge.bronze { background: linear-gradient(135deg, #CD7F32, #A0522D); }
        .ranking-badge.normal { background: rgba(255,255,255,0.2); }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .ranking-detail {
            font-size: 0.8rem;
            opacity: 0.85;
        }

        .ranking-total {
            font-weight: 700;
            font-size: 1.1rem;
            font-family: 'Mitr', sans-serif;
        }

        .manage-stock-input {
            width: 70px;
            padding: 6px 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Prompt', sans-serif;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .manage-stock-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(78,205,196,0.15);
        }

        .btn-stock {
            background: none;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            color: var(--secondary);
            cursor: pointer;
            padding: 6px 12px;
            font-size: 0.85rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-stock:hover {
            background: var(--secondary);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease-out;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-card {
            background: white;
            border-radius: 28px;
            padding: 40px;
            max-width: 440px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: scaleIn 0.4s ease-out;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo-icon {
            font-size: 4rem;
            margin-bottom: 10px;
            display: block;
        }

        .login-logo h2 {
            font-family: 'Mitr', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-logo p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .login-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .login-tab {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            font-family: 'Prompt', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .login-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }

        .login-tab:not(.active):hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .login-form input {
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }

        .login-form .btn {
            padding: 14px;
            font-size: 1.05rem;
        }

        .login-message {
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            display: none;
        }

        .login-message.error {
            display: block;
            background: #FFE5E5;
            color: var(--primary);
            border: 2px solid #FFD1D1;
        }

        .login-message.success {
            display: block;
            background: #E8F8F5;
            color: var(--success);
            border: 2px solid #B2F2E8;
        }

        .login-hint {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: -6px;
        }

        .user-greeting {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 10px 18px;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .user-greeting-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .btn-logout {
            background: none;
            border: 2px solid #FFD1D1;
            border-radius: 8px;
            color: var(--primary);
            cursor: pointer;
            padding: 6px 14px;
            font-size: 0.85rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <span class="login-logo-icon">üç™</span>
                <h2>Snack Tracker</h2>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏°</p>
            </div>

            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <button class="login-tab" onclick="switchLoginTab('register')">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà</button>
            </div>

            <!-- Login Form -->
            <div id="loginMessage" class="login-message"></div>

            <div id="loginForm" class="login-form">
                <input type="text" id="loginNameInput" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" onkeydown="if(event.key==='Enter')loginUser()">
                <button class="btn btn-primary" onclick="loginUser()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="login-form" style="display: none;">
                <input type="text" id="registerDisplayName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡∏ò‡∏ô‡∏ä‡∏¥‡∏ï)" onkeydown="if(event.key==='Enter')document.getElementById('registerAliases').focus()">
                <input type="text" id="registerAliases" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ , (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏¥‡∏ï, chit)" onkeydown="if(event.key==='Enter')registerUser()">
                <span class="login-hint">* ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ login ‡πÑ‡∏î‡πâ ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ,</span>
                <button class="btn btn-secondary" onclick="registerUser()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>üç™ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏°</h1>
            <div class="header-info">
                <div class="user-greeting" id="userGreeting">
                    <span class="user-greeting-name" id="userGreetingName"></span>
                    <button class="btn-logout" onclick="logoutUser()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                </div>
                <div class="date-display" id="currentDate"></div>
                <button class="btn btn-outline" onclick="showManageModal()">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button class="btn btn-secondary" onclick="showMonthlyReport()">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
            </div>
        </header>

        <div class="card">
            <h2 class="card-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</h2>
            <div class="snack-grid" id="snackGrid"></div>

            <div class="summary-card">
                <div class="summary-title">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="summary-content">
                    <div class="summary-item">
                        <div class="summary-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="summary-value" id="todayCount">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
                        <div class="summary-value" id="todayTotal">0 ‡∏ø</div>
                    </div>
                </div>
                <div id="todayPurchaseList" style="margin-top: 20px;"></div>
            </div>

            <div class="ranking-card" id="rankingCard" style="display: none;">
                <div class="ranking-title">üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                <div class="ranking-list" id="rankingList"></div>
            </div>
        </div>
    </div>

    <!-- Manage Modal -->
    <div class="modal" id="manageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <button class="close-btn" onclick="closeManageModal()">&times;</button>
            </div>

            <div class="manage-tabs">
                <button class="manage-tab active" onclick="switchManageTab('snacks')">üç™ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button class="manage-tab" onclick="switchManageTab('customers')">üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
            </div>

            <!-- Snacks Tab -->
            <div id="manageSnacksTab">
                <div class="manage-form">
                    <div class="image-upload-wrapper">
                        <input type="file" id="newSnackImage" accept="image/*" onchange="previewSnackImage(this)">
                        <div class="image-drop-zone" id="imageDropZone" onclick="document.getElementById('newSnackImage').click()" tabindex="0">
                            <span class="drop-icon">üì∑</span>
                            <span class="drop-text">‡∏ß‡∏≤‡∏á/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span>
                        </div>
                    </div>
                    <input type="text" id="newSnackName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <input type="number" id="newSnackPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" min="1" style="max-width: 100px;">
                    <input type="number" id="newSnackStock" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0" style="max-width: 100px;">
                    <button class="btn btn-primary" onclick="addSnack()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div class="manage-list" id="manageSnackList" style="margin-top: 15px;"></div>
            </div>

            <!-- Customers Tab -->
            <div id="manageCustomersTab" style="display: none;">
                <div class="manage-form">
                    <input type="text" id="newCustomerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    <select id="newCustomerShift" style="padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 0.95rem; min-width: 120px;">
                        <option value="A">Shift A</option>
                        <option value="B">Shift B</option>
                        <option value="C">Shift C</option>
                        <option value="D">Shift D</option>
                    </select>
                    <button class="btn btn-primary" onclick="addCustomer()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div class="manage-list" id="manageCustomerList" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <!-- Select Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span id="selectedSnackEmoji"></span>
                    <span id="selectedSnackName"></span>
                </div>

                <button class="close-btn" onclick="closeCustomerModal()">&times;</button>
            </div>

            <div class="price-display">
                <div class="price-label">‡∏£‡∏≤‡∏Ñ‡∏≤</div>
                <div class="price-value"><span id="selectedSnackPrice"></span> ‡∏ö‡∏≤‡∏ó</div>
            </div>

            <div class="search-box">
                <input type="text" 
                       id="customerSearch" 
                       placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."
                       oninput="filterCustomers()">
            </div>

            <div class="shift-filter" id="shiftFilter">
                <button class="shift-btn active" onclick="filterShift('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button class="shift-btn" onclick="filterShift('A')">Shift A</button>
                <button class="shift-btn" onclick="filterShift('B')">Shift B</button>
                <button class="shift-btn" onclick="filterShift('C')">Shift C</button>
                <button class="shift-btn" onclick="filterShift('D')">Shift D</button>
            </div>

            <div class="customer-section-title">
                üìù ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
            </div>
            <div class="customer-grid" id="customerGrid"></div>

            <div id="confirmSection" style="display: none; margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--border);">
                <div style="text-align: center; margin-bottom: 12px; font-weight: 500; color: var(--text-dark);">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß <span id="selectedCount" style="color: var(--primary); font-weight: 700;">0</span> ‡∏Ñ‡∏ô
                </div>
                <button class="btn btn-primary" onclick="confirmPurchase()" style="width: 100%; padding: 16px; font-size: 1.1rem;">
                    ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- Monthly Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                <button class="close-btn" onclick="closeReportModal()">&times;</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-dark);">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ
                </label>
                <input type="month" 
                       id="reportMonth" 
                       onchange="generateReport()"
                       style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Prompt', sans-serif;">
            </div>

            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        // Default snack items
        const defaultSnacks = [
            { id: 1, name: '‡∏°‡∏≤‡∏°‡πà‡∏≤', emoji: 'üçú', price: 7, stock: 50 },
            { id: 2, name: '‡πÇ‡∏Ñ‡∏Ñ‡∏≤', emoji: 'ü•§', price: 15, stock: 30 },
            { id: 3, name: '‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏°', emoji: 'üíß', price: 7, stock: 100 },
            { id: 4, name: '‡πÄ‡∏•‡∏¢‡πå', emoji: 'ü•î', price: 20, stock: 40 },
            { id: 5, name: '‡∏õ‡∏•‡∏≤‡∏Å‡∏£‡∏≤‡∏ö', emoji: 'üêü', price: 10, stock: 30 },
            { id: 6, name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á', emoji: 'üçû', price: 12, stock: 25 },
            { id: 7, name: '‡∏ô‡∏°', emoji: 'ü•õ', price: 15, stock: 20 },
            { id: 8, name: '‡∏Å‡∏≤‡πÅ‡∏ü', emoji: '‚òï', price: 25, stock: 30 },
            { id: 9, name: '‡∏ä‡πá‡∏≠‡∏Ñ‡πÇ‡∏Å‡πÅ‡∏•‡∏ï', emoji: 'üç´', price: 30, stock: 15 },
            { id: 10, name: '‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°', emoji: 'üç¶', price: 35, stock: 10 },
            { id: 11, name: '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ', emoji: 'üç™', price: 18, stock: 20 },
            { id: 12, name: '‡∏Ç‡∏ô‡∏°‡∏≠‡∏ö', emoji: 'ü•ê', price: 22, stock: 15 }
        ];

        // Default customer list with shifts
        const defaultCustomers = [
            { name: '‡πÄ‡∏≠', shift: 'A' }, { name: '‡∏ö‡∏µ', shift: 'A' }, { name: '‡∏ã‡∏µ', shift: 'A' },
            { name: '‡∏î‡∏µ', shift: 'A' }, { name: '‡∏≠‡∏µ', shift: 'A' }, { name: '‡πÄ‡∏≠‡∏ü', shift: 'A' },
            { name: '‡∏à‡∏µ', shift: 'A' },
            { name: '‡πÄ‡∏≠‡∏ä', shift: 'B' }, { name: '‡πÑ‡∏≠', shift: 'B' }, { name: '‡πÄ‡∏à', shift: 'B' },
            { name: '‡πÄ‡∏Ñ', shift: 'B' }, { name: '‡πÅ‡∏≠‡∏•', shift: 'B' }, { name: '‡πÄ‡∏≠‡πá‡∏°', shift: 'B' },
            { name: '‡πÄ‡∏≠‡πá‡∏ô', shift: 'B' },
            { name: '‡πÇ‡∏≠', shift: 'C' }, { name: '‡∏û‡∏µ', shift: 'C' }, { name: '‡∏Ñ‡∏¥‡∏ß', shift: 'C' },
            { name: '‡∏≠‡∏≤‡∏£‡πå', shift: 'C' }, { name: '‡πÄ‡∏≠‡∏™', shift: 'C' }, { name: '‡∏ó‡∏µ', shift: 'C' },
            { name: '‡∏¢‡∏π', shift: 'C' },
            { name: '‡∏ß‡∏µ', shift: 'D' }, { name: '‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡πâ‡∏•‡∏¢‡∏π', shift: 'D' }, { name: '‡πÄ‡∏≠‡πá‡∏Å‡∏ã‡πå', shift: 'D' },
            { name: '‡∏ß‡∏≤‡∏¢', shift: 'D' }, { name: '‡πÅ‡∏ã‡∏î', shift: 'D' }, { name: '‡∏ö‡∏≠‡∏°', shift: 'D' },
            { name: '‡∏ô‡∏¥‡∏ß', shift: 'D' }
        ];

        // Load from localStorage or use defaults
        let snacks = JSON.parse(localStorage.getItem('snackItems')) || [...defaultSnacks];
        let customers = JSON.parse(localStorage.getItem('customerList')) || [...defaultCustomers];

        let purchases = [];
        let selectedSnack = null;
        let selectedCustomers = {}; // { name: quantity }
        let activeShift = 'all'; // 'all', 'A', 'B', 'C', 'D'

        // === Login System ===
        let users = JSON.parse(localStorage.getItem('snackUsers')) || [];
        let currentUser = null;

        function saveUsers() {
            localStorage.setItem('snackUsers', JSON.stringify(users));
        }

        function checkSession() {
            const savedUserId = localStorage.getItem('snackCurrentUser');
            if (savedUserId) {
                const user = users.find(u => u.id === parseInt(savedUserId));
                if (user) {
                    currentUser = user;
                    showApp();
                    return true;
                }
            }
            showLoginScreen();
            return false;
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.querySelector('.container').style.display = 'none';
            setTimeout(() => {
                const input = document.getElementById('loginNameInput');
                if (input) input.focus();
            }, 300);
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.querySelector('.container').style.display = 'block';
            document.getElementById('userGreetingName').textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${currentUser.displayName} üëã`;
            initApp();
        }

        function showLoginMessage(text, type = 'error') {
            const msg = document.getElementById('loginMessage');
            msg.textContent = text;
            msg.className = `login-message ${type}`;
            // Auto hide after 4 seconds
            setTimeout(() => { msg.className = 'login-message'; }, 4000);
        }

        function switchLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('loginMessage').className = 'login-message';
            if (tab === 'login') {
                document.querySelectorAll('.login-tab')[0].classList.add('active');
                document.getElementById('loginForm').style.display = 'flex';
                document.getElementById('registerForm').style.display = 'none';
            } else {
                document.querySelectorAll('.login-tab')[1].classList.add('active');
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'flex';
            }
        }

        function loginUser() {
            const nameInput = document.getElementById('loginNameInput').value.trim();
            if (!nameInput) {
                showLoginMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠');
                return;
            }

            const searchName = nameInput.toLowerCase();
            const foundUser = users.find(u =>
                u.aliases.some(alias => alias.toLowerCase() === searchName)
            );

            if (!foundUser) {
                showLoginMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà"');
                return;
            }

            currentUser = foundUser;
            localStorage.setItem('snackCurrentUser', foundUser.id);
            document.getElementById('loginNameInput').value = '';
            showApp();
            showToast(`‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ${foundUser.displayName}! üéâ`, 'success');
        }

        function registerUser() {
            const displayName = document.getElementById('registerDisplayName').value.trim();
            const aliasesStr = document.getElementById('registerAliases').value.trim();

            if (!displayName) {
                showLoginMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å');
                return;
            }

            // Build aliases array: always include displayName + any comma-separated aliases
            const aliases = [displayName];
            if (aliasesStr) {
                aliasesStr.split(',').forEach(a => {
                    const trimmed = a.trim();
                    if (trimmed && !aliases.some(x => x.toLowerCase() === trimmed.toLowerCase())) {
                        aliases.push(trimmed);
                    }
                });
            }

            // Check for duplicate aliases with existing users
            for (const alias of aliases) {
                const conflict = users.find(u =>
                    u.aliases.some(a => a.toLowerCase() === alias.toLowerCase())
                );
                if (conflict) {
                    showLoginMessage(`‡∏ä‡∏∑‡πà‡∏≠ "${alias}" ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß (${conflict.displayName})`);
                    return;
                }
            }

            const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
            const newUser = { id: newId, displayName, aliases };
            users.push(newUser);
            saveUsers();

            // Auto login
            currentUser = newUser;
            localStorage.setItem('snackCurrentUser', newUser.id);

            document.getElementById('registerDisplayName').value = '';
            document.getElementById('registerAliases').value = '';

            showApp();
            showToast(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${displayName}! üéâ`, 'success');
        }

        function logoutUser() {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            currentUser = null;
            localStorage.removeItem('snackCurrentUser');
            showLoginScreen();
            showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        // Update customer ranking
        function updateRanking() {
            if (purchases.length === 0) {
                document.getElementById('rankingCard').style.display = 'none';
                return;
            }

            const customerTotals = {};
            purchases.forEach(p => {
                if (!customerTotals[p.customerName]) {
                    customerTotals[p.customerName] = { total: 0, count: 0 };
                }
                customerTotals[p.customerName].total += p.price;
                customerTotals[p.customerName].count += 1;
            });

            const sorted = Object.entries(customerTotals)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 10);

            if (sorted.length === 0) {
                document.getElementById('rankingCard').style.display = 'none';
                return;
            }

            document.getElementById('rankingCard').style.display = 'block';

            const badgeClasses = ['gold', 'silver', 'bronze'];
            const medals = ['ü•á', 'ü•à', 'ü•â'];

            document.getElementById('rankingList').innerHTML = sorted.map(([name, data], i) => {
                const badgeClass = i < 3 ? badgeClasses[i] : 'normal';
                const label = i < 3 ? medals[i] : (i + 1);
                return `
                    <div class="ranking-item">
                        <div class="ranking-badge ${badgeClass}">${label}</div>
                        <div class="ranking-info">
                            <div class="ranking-name">${name}</div>
                            <div class="ranking-detail">‡∏ã‡∏∑‡πâ‡∏≠ ${data.count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                        </div>
                        <div class="ranking-total">${data.total} ‡∏ø</div>
                    </div>
                `;
            }).join('');
        }

        // Initialize the app
        function init() {
            // Check login session first
            if (!checkSession()) return;

            initApp();
        }

        function initApp() {
            updateCurrentDate();
            renderSnackGrid();
            loadPurchases();
            updateTodaySummary();
            updateRanking();
            setupImageUpload();

            // Set default report month to current month
            const today = new Date();
            document.getElementById('reportMonth').value =
                `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        }

        // Update current date display
        function updateCurrentDate() {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = new Date().toLocaleDateString('th-TH', options);
            document.getElementById('currentDate').textContent = dateStr;
        }

        // Render snack grid
        function renderSnackGrid() {
            const grid = document.getElementById('snackGrid');
            grid.innerHTML = snacks.map(snack => {
                const stock = snack.stock || 0;
                const soldOut = stock <= 0;
                let stockClass = 'in-stock';
                let stockText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${stock}`;
                if (stock <= 0) { stockClass = 'out-of-stock'; stockText = '‡∏´‡∏°‡∏î'; }
                else if (stock <= 5) { stockClass = 'low-stock'; stockText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${stock}!`; }

                return `
                    <div class="snack-item ${soldOut ? 'sold-out' : ''}" onclick="${soldOut ? '' : `selectSnack(${snack.id})`}">
                        ${getSnackDisplayHTML(snack, 'grid')}
                        <div class="snack-name">${snack.name}</div>
                        <div class="snack-price">${snack.price} ‡∏ø</div>
                        <div class="snack-stock ${stockClass}">${stockText}</div>
                    </div>
                `;
            }).join('');
        }

        // Select snack
        function selectSnack(snackId) {
            selectedSnack = snacks.find(s => s.id === snackId);
            selectedCustomers = {};
            activeShift = 'all';

            // Update modal content
            document.getElementById('selectedSnackEmoji').innerHTML = getSnackDisplayHTML(selectedSnack, 'modal');
            document.getElementById('selectedSnackName').textContent = selectedSnack.name;
            document.getElementById('selectedSnackPrice').textContent = selectedSnack.price;

            // Clear search
            document.getElementById('customerSearch').value = '';

            // Hide confirm section
            updateConfirmSection();

            // Render customer grid
            renderCustomerGrid();

            // Show modal
            document.getElementById('customerModal').classList.add('active');

            // Focus on search after modal animation
            setTimeout(() => {
                document.getElementById('customerSearch').focus();
            }, 300);
        }

        // Render customer grid
        function renderCustomerGrid(filter = '') {
            const grid = document.getElementById('customerGrid');
            const filteredCustomers = customers.filter(c => {
                const nameMatch = c.name.toLowerCase().includes(filter.toLowerCase());
                const shiftMatch = activeShift === 'all' || c.shift === activeShift;
                return nameMatch && shiftMatch;
            });

            grid.innerHTML = filteredCustomers.map(c => {
                const name = c.name;
                const qty = selectedCustomers[name] || 0;
                const isSelected = qty > 0;
                if (isSelected) {
                    return `
                        <div class="customer-btn selected" onclick="selectCustomer('${name}')">
                            <button class="qty-btn qty-btn-minus" onclick="event.stopPropagation(); changeQty('${name}', -1)">-</button>
                            <span class="customer-name-label">${name} <strong>(${qty})</strong></span>
                            <button class="qty-btn qty-btn-plus" onclick="event.stopPropagation(); changeQty('${name}', 1)">+</button>
                        </div>
                    `;
                }
                return `
                    <button class="customer-btn" onclick="selectCustomer('${name}')">
                        ${name}
                    </button>
                `;
            }).join('');

            // Update shift button active state
            document.querySelectorAll('.shift-btn').forEach(btn => btn.classList.remove('active'));
            const shiftBtns = document.querySelectorAll('.shift-btn');
            const shiftIndex = ['all', 'A', 'B', 'C', 'D'].indexOf(activeShift);
            if (shiftBtns[shiftIndex]) shiftBtns[shiftIndex].classList.add('active');
        }

        // Filter by shift
        function filterShift(shift) {
            activeShift = shift;
            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
        }

        // Filter customers
        function filterCustomers() {
            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
        }

        // Select customer (first click = qty 1, click again = +1)
        function selectCustomer(name) {
            if (!selectedCustomers[name]) {
                selectedCustomers[name] = 1;
            } else {
                selectedCustomers[name]++;
            }

            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
            updateConfirmSection();
        }

        // Change quantity with +/- buttons
        function changeQty(name, delta) {
            const newQty = (selectedCustomers[name] || 0) + delta;
            if (newQty <= 0) {
                delete selectedCustomers[name];
            } else {
                selectedCustomers[name] = newQty;
            }

            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
            updateConfirmSection();
        }

        // Update confirm section visibility and count
        function updateConfirmSection() {
            const section = document.getElementById('confirmSection');
            const customerCount = Object.keys(selectedCustomers).length;
            const totalQty = Object.values(selectedCustomers).reduce((sum, q) => sum + q, 0);

            if (customerCount > 0) {
                section.style.display = 'block';
                const totalPrice = totalQty * (selectedSnack ? selectedSnack.price : 0);
                document.getElementById('selectedCount').innerHTML =
                    `${customerCount} ‡∏Ñ‡∏ô / ${totalQty} ‡∏ä‡∏¥‡πâ‡∏ô / ‡∏£‡∏ß‡∏° ${totalPrice} ‡∏ø`;
            } else {
                section.style.display = 'none';
            }
        }

        // Confirm purchase for all selected customers
        function confirmPurchase() {
            const customerCount = Object.keys(selectedCustomers).length;
            const totalQty = Object.values(selectedCustomers).reduce((sum, q) => sum + q, 0);

            if (customerCount === 0) {
                showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'warning');
                return;
            }

            if (!selectedSnack) {
                showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏°', 'warning');
                closeCustomerModal();
                return;
            }

            // Check stock
            const snackInList = snacks.find(s => s.id === selectedSnack.id);
            if (!snackInList || snackInList.stock < totalQty) {
                showToast(`‚ö†Ô∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${snackInList ? snackInList.stock : 0} ‡∏ä‡∏¥‡πâ‡∏ô, ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${totalQty} ‡∏ä‡∏¥‡πâ‡∏ô)`, 'warning');
                return;
            }

            // Create purchase records for each selected customer x quantity
            const now = new Date().toISOString();
            Object.entries(selectedCustomers).forEach(([customerName, qty]) => {
                for (let i = 0; i < qty; i++) {
                    const purchase = {
                        id: Date.now() + Math.random(),
                        customerName: customerName,
                        snack: { ...selectedSnack },
                        price: selectedSnack.price,
                        date: now
                    };
                    purchases.unshift(purchase);
                }
            });

            // Decrease stock
            snackInList.stock -= totalQty;
            saveSnacks();

            savePurchases();
            updateTodaySummary();
            renderSnackGrid();
            updateRanking();

            const names = Object.entries(selectedCustomers).map(([n, q]) => `${n}(${q})`).join(', ');
            showToast(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ${selectedSnack.name} - ${names}`, 'success');

            closeCustomerModal();
        }

        // Close customer modal
        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('active');
            selectedSnack = null;
            selectedCustomers = {};
        }

        // Update today's summary
        function updateTodaySummary() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const todayPurchases = purchases.filter(p => {
                const purchaseDate = new Date(p.date);
                purchaseDate.setHours(0, 0, 0, 0);
                return purchaseDate.getTime() === today.getTime();
            });

            const count = todayPurchases.length;
            const total = todayPurchases.reduce((sum, p) => sum + p.price, 0);

            document.getElementById('todayCount').textContent = count;
            document.getElementById('todayTotal').textContent = `${total} ‡∏ø`;

            // Render today's purchase list
            const listContainer = document.getElementById('todayPurchaseList');
            if (todayPurchases.length === 0) {
                listContainer.innerHTML = '';
                return;
            }

            const showCount = 5;
            let html = `<div class="today-purchase-header">
                <span>üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ${Math.min(showCount, todayPurchases.length)}/${todayPurchases.length})</span>
            </div>`;

            todayPurchases.slice(0, showCount).forEach(p => {
                const time = new Date(p.date).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                html += `
                    <div class="today-purchase-item">
                        <div class="purchase-info">
                            ${getSnackDisplayHTML(p.snack, 'mini')}
                            <span><strong>${p.customerName}</strong> - ${p.snack.name}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="purchase-time">${time}</span>
                            <span class="purchase-price">${p.price} ‡∏ø</span>
                        </div>
                    </div>`;
            });

            listContainer.innerHTML = html;
        }

        // Show monthly report modal
        function showMonthlyReport() {
            document.getElementById('reportModal').classList.add('active');
            generateReport();
        }

        // Close report modal
        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        // Generate monthly report
        function generateReport() {
            const reportMonth = document.getElementById('reportMonth').value;
            if (!reportMonth) return;
            
            const [year, month] = reportMonth.split('-').map(Number);
            const monthStart = new Date(year, month - 1, 1);
            const monthEnd = new Date(year, month, 0, 23, 59, 59);
            
            const monthlyPurchases = purchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                return purchaseDate >= monthStart && purchaseDate <= monthEnd;
            });
            
            if (monthlyPurchases.length === 0) {
                document.getElementById('reportContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
                return;
            }

            // Group by customer
            const customerData = {};
            monthlyPurchases.forEach(purchase => {
                if (!customerData[purchase.customerName]) {
                    customerData[purchase.customerName] = {
                        total: 0,
                        count: 0,
                        items: []
                    };
                }
                customerData[purchase.customerName].total += purchase.price;
                customerData[purchase.customerName].count += 1;
                customerData[purchase.customerName].items.push(purchase.snack);
            });
            
            const totalRevenue = monthlyPurchases.reduce((sum, p) => sum + p.price, 0);
            const totalTransactions = monthlyPurchases.length;
            const totalCustomers = Object.keys(customerData).length;
            const avgPerTransaction = Math.round(totalRevenue / totalTransactions);
            
            // Render report
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="stat-value">${totalRevenue} ‡∏ø</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                        <div class="stat-value">${totalTransactions}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
                        <div class="stat-value">${totalCustomers}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                        <div class="stat-value">${avgPerTransaction} ‡∏ø</div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 15px; color: var(--text-dark); font-size: 1.2rem;">
                        üí∞ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ï‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                    </h4>
                    <div class="customer-detail-list">
                        ${Object.entries(customerData)
                            .sort((a, b) => b[1].total - a[1].total)
                            .map(([name, data]) => {
                                // Count snack types
                                const snackCounts = {};
                                data.items.forEach(snack => {
                                    snackCounts[snack.name] = (snackCounts[snack.name] || 0) + 1;
                                });
                                const topSnacks = Object.entries(snackCounts)
                                    .sort((a, b) => b[1] - a[1])
                                    .slice(0, 3)
                                    .map(([name, count]) => `${name} (${count})`)
                                    .join(', ');
                                
                                return `
                                    <div class="customer-detail-item">
                                        <div class="customer-detail-header">
                                            <div class="customer-detail-name">${name}</div>
                                            <div class="customer-detail-total">${data.total} ‡∏ø</div>
                                        </div>
                                        <div class="customer-detail-info">
                                            <span>üõí ‡∏ã‡∏∑‡πâ‡∏≠ ${data.count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                                            <span>üìä ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${Math.round(data.total / data.count)} ‡∏ø/‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                                        </div>
                                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-light);">
                                            <strong>‡∏Ç‡∏ô‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ö‡πà‡∏≠‡∏¢:</strong> ${topSnacks}
                                        </div>
                                        <div class="qr-container">
                                            <button class="btn btn-secondary" style="width: 100%;" 
                                                    onclick="generateQR('${name}', ${data.total})">
                                                üîó ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                    </div>
                </div>

                <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px solid var(--border);">
                    <button class="btn btn-outline" onclick="exportReport()" style="width: 100%;">
                        üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (TXT)
                    </button>
                </div>
            `;
        }

        // Generate QR Code
        function generateQR(customerName, amount) {
            const qrData = `‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ${customerName}\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ${amount} ‡∏ö‡∏≤‡∏ó`;
            
            showToast(`üîó ‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
            
            alert(`QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: ${customerName}\n‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô: ${amount} ‡∏ö‡∏≤‡∏ó\n\n‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á QR Code ‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ`);
        }

        // Export report
        function exportReport() {
            const reportMonth = document.getElementById('reportMonth').value;
            if (!reportMonth) return;
            
            const [year, month] = reportMonth.split('-').map(Number);
            const monthStart = new Date(year, month - 1, 1);
            const monthEnd = new Date(year, month, 0, 23, 59, 59);
            
            const monthlyPurchases = purchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                return purchaseDate >= monthStart && purchaseDate <= monthEnd;
            });

            if (monthlyPurchases.length === 0) {
                showToast('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'warning');
                return;
            }

            // Create report text
            const monthName = new Date(year, month - 1).toLocaleDateString('th-TH', { year: 'numeric', month: 'long' });
            
            let reportText = `=== ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡∏ô‡∏° ${monthName} ===\n\n`;
            
            // Group by customer
            const customerData = {};
            monthlyPurchases.forEach(purchase => {
                if (!customerData[purchase.customerName]) {
                    customerData[purchase.customerName] = {
                        total: 0,
                        items: []
                    };
                }
                customerData[purchase.customerName].total += purchase.price;
                customerData[purchase.customerName].items.push({
                    snack: purchase.snack.name,
                    price: purchase.price,
                    date: new Date(purchase.date).toLocaleDateString('th-TH')
                });
            });

            // Add customer details
            Object.entries(customerData)
                .sort((a, b) => b[1].total - a[1].total)
                .forEach(([name, data]) => {
                    reportText += `\n${name}\n`;
                    reportText += `${'='.repeat(name.length)}\n`;
                    reportText += `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${data.total} ‡∏ö‡∏≤‡∏ó\n`;
                    reportText += `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:\n`;
                    data.items.forEach(item => {
                        reportText += `  - ${item.date}: ${item.snack} (${item.price} ‡∏ö‡∏≤‡∏ó)\n`;
                    });
                    reportText += `\n`;
                });

            // Add summary
            const totalRevenue = monthlyPurchases.reduce((sum, p) => sum + p.price, 0);
            reportText += `\n=== ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏° ===\n`;
            reportText += `‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalRevenue} ‡∏ö‡∏≤‡∏ó\n`;
            reportText += `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${monthlyPurchases.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n`;
            reportText += `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${Object.keys(customerData).length} ‡∏Ñ‡∏ô\n`;

            // Create download
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏ô‡∏°_${reportMonth}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            if (type === 'warning') {
                toast.style.background = 'linear-gradient(135deg, var(--warning), #F2B84B)';
            } else if (type === 'info') {
                toast.style.background = 'linear-gradient(135deg, var(--secondary), #3FBDB5)';
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInFromRight 0.4s ease-out reverse';
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        // Save purchases to localStorage
        function savePurchases() {
            localStorage.setItem('snackPurchases', JSON.stringify(purchases));
        }

        // Load purchases from localStorage
        function loadPurchases() {
            const saved = localStorage.getItem('snackPurchases');
            if (saved) {
                purchases = JSON.parse(saved);
            }
        }

        // === Manage Modal Functions ===

        function showManageModal() {
            document.getElementById('manageModal').classList.add('active');
            switchManageTab('snacks');
        }

        function closeManageModal() {
            document.getElementById('manageModal').classList.remove('active');
        }

        function switchManageTab(tab) {
            document.querySelectorAll('.manage-tab').forEach(t => t.classList.remove('active'));
            if (tab === 'snacks') {
                document.querySelectorAll('.manage-tab')[0].classList.add('active');
                document.getElementById('manageSnacksTab').style.display = 'block';
                document.getElementById('manageCustomersTab').style.display = 'none';
                renderManageSnackList();
            } else {
                document.querySelectorAll('.manage-tab')[1].classList.add('active');
                document.getElementById('manageSnacksTab').style.display = 'none';
                document.getElementById('manageCustomersTab').style.display = 'block';
                renderManageCustomerList();
            }
        }

        // --- Snack CRUD ---

        // Helper: get snack display HTML (image or emoji fallback)
        function getSnackDisplayHTML(snack, size = 'grid') {
            if (snack.image) {
                const classMap = {
                    'grid': 'snack-img',
                    'manage': 'snack-img-preview',
                    'modal': 'snack-img-modal',
                    'mini': 'snack-img-mini'
                };
                return `<img src="${snack.image}" alt="${snack.name}" class="${classMap[size] || 'snack-img'}">`;
            }
            if (size === 'grid') return `<span class="snack-emoji">${snack.emoji || 'üç™'}</span>`;
            if (size === 'manage') return `<span style="font-size: 1.5rem;">${snack.emoji || 'üç™'}</span>`;
            if (size === 'modal') return `<span style="font-size: 2rem;">${snack.emoji || 'üç™'}</span>`;
            return `<span>${snack.emoji || 'üç™'}</span>`;
        }

        // Get snack display name for toast (no HTML)
        function getSnackLabel(snack) {
            return snack.emoji ? `${snack.emoji} ${snack.name}` : snack.name;
        }

        // Preview image when selected in add form
        let pendingSnackImage = null;

        // Process image file (from file input, paste, or drag)
        function processImageFile(file) {
            if (!file || !file.type.startsWith('image/')) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const maxSize = 150;
                    let w = img.width, h = img.height;
                    if (w > h) { if (w > maxSize) { h = h * maxSize / w; w = maxSize; } }
                    else { if (h > maxSize) { w = w * maxSize / h; h = maxSize; } }
                    canvas.width = w;
                    canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    pendingSnackImage = canvas.toDataURL('image/jpeg', 0.7);
                    updateImagePreview();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function updateImagePreview() {
            const dropZone = document.getElementById('imageDropZone');
            if (pendingSnackImage) {
                dropZone.innerHTML = `<img src="${pendingSnackImage}" alt="preview">`;
                dropZone.classList.add('has-image');
            } else {
                dropZone.innerHTML = '<span class="drop-icon">üì∑</span><span class="drop-text">‡∏ß‡∏≤‡∏á/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</span>';
                dropZone.classList.remove('has-image');
            }
        }

        // From file input
        function previewSnackImage(input) {
            processImageFile(input.files[0]);
        }

        // Setup paste & drag-drop on the drop zone
        function setupImageUpload() {
            const dropZone = document.getElementById('imageDropZone');
            if (!dropZone) return;

            // Paste anywhere in the manage modal
            document.getElementById('manageModal').addEventListener('paste', function(e) {
                // Only handle if snacks tab is visible
                if (document.getElementById('manageSnacksTab').style.display === 'none') return;
                const items = e.clipboardData?.items;
                if (!items) return;
                for (const item of items) {
                    if (item.type.startsWith('image/')) {
                        e.preventDefault();
                        processImageFile(item.getAsFile());
                        showToast('‚úÖ ‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        return;
                    }
                }
            });

            // Drag & drop
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            dropZone.addEventListener('dragleave', function() {
                dropZone.classList.remove('drag-over');
            });
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                const file = e.dataTransfer?.files[0];
                if (file && file.type.startsWith('image/')) {
                    processImageFile(file);
                }
            });

            // Paste when drop zone is focused
            dropZone.addEventListener('paste', function(e) {
                const items = e.clipboardData?.items;
                if (!items) return;
                for (const item of items) {
                    if (item.type.startsWith('image/')) {
                        e.preventDefault();
                        processImageFile(item.getAsFile());
                        showToast('‚úÖ ‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        return;
                    }
                }
            });
        }

        function renderManageSnackList() {
            const list = document.getElementById('manageSnackList');
            if (snacks.length === 0) {
                list.innerHTML = '<div class="empty-state" style="padding: 30px;"><div class="empty-state-icon">üç™</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p></div>';
                return;
            }
            list.innerHTML = snacks.map(s => `
                <div class="manage-item">
                    <div class="manage-item-info">
                        ${getSnackDisplayHTML(s, 'manage')}
                        <span>${s.name}</span>
                        <span class="manage-item-price">${s.price} ‡∏ø</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 0.85rem; color: var(--text-light);">‡∏Ñ‡∏•‡∏±‡∏á:</span>
                        <input type="number" class="manage-stock-input" value="${s.stock || 0}" min="0"
                               onchange="updateStock(${s.id}, this.value)">
                        <button class="btn-stock" onclick="addStock(${s.id}, 10)">+10</button>
                        <button class="btn-delete" onclick="deleteSnack(${s.id})">‡∏•‡∏ö</button>
                    </div>
                </div>
            `).join('');
        }

        function addSnack() {
            const name = document.getElementById('newSnackName').value.trim();
            const price = parseInt(document.getElementById('newSnackPrice').value);
            const stock = parseInt(document.getElementById('newSnackStock').value) || 0;

            if (!pendingSnackImage) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'warning'); return; }
            if (!name) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'warning'); return; }
            if (!price || price <= 0) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning'); return; }

            const newId = snacks.length > 0 ? Math.max(...snacks.map(s => s.id)) + 1 : 1;
            snacks.push({ id: newId, name, image: pendingSnackImage, emoji: '', price, stock });
            saveSnacks();
            renderManageSnackList();
            renderSnackGrid();

            // Reset form
            pendingSnackImage = null;
            document.getElementById('newSnackImage').value = '';
            updateImagePreview();
            document.getElementById('newSnackName').value = '';
            document.getElementById('newSnackPrice').value = '';
            document.getElementById('newSnackStock').value = '';

            showToast(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° ${name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
        }

        function updateStock(id, value) {
            const snack = snacks.find(s => s.id === id);
            if (snack) {
                snack.stock = Math.max(0, parseInt(value) || 0);
                saveSnacks();
                renderSnackGrid();
            }
        }

        function addStock(id, amount) {
            const snack = snacks.find(s => s.id === id);
            if (snack) {
                snack.stock = (snack.stock || 0) + amount;
                saveSnacks();
                renderManageSnackList();
                renderSnackGrid();
                showToast(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å ${snack.name} +${amount}`, 'success');
            }
        }

        function deleteSnack(id) {
            const snack = snacks.find(s => s.id === id);
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${snack.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;

            snacks = snacks.filter(s => s.id !== id);
            saveSnacks();
            renderManageSnackList();
            renderSnackGrid();

            showToast(`üóëÔ∏è ‡∏•‡∏ö ${snack.name} ‡πÅ‡∏•‡πâ‡∏ß`, 'info');
        }

        function saveSnacks() {
            localStorage.setItem('snackItems', JSON.stringify(snacks));
        }

        // --- Customer CRUD ---

        function renderManageCustomerList() {
            const list = document.getElementById('manageCustomerList');
            if (customers.length === 0) {
                list.innerHTML = '<div class="empty-state" style="padding: 30px;"><div class="empty-state-icon">üë•</div><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p></div>';
                return;
            }
            const shifts = ['A', 'B', 'C', 'D'];
            list.innerHTML = shifts.map(shift => {
                const group = customers.filter(c => c.shift === shift);
                if (group.length === 0) return '';
                return `
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; color: var(--secondary); margin-bottom: 8px; font-size: 0.95rem;">Shift ${shift} (${group.length} ‡∏Ñ‡∏ô)</div>
                        ${group.map(c => `
                            <div class="manage-item">
                                <div class="manage-item-info">
                                    <span>üë§</span>
                                    <span>${c.name}</span>
                                    <span style="font-size: 0.8rem; color: var(--text-light); background: #f0f0f0; padding: 2px 8px; border-radius: 6px;">Shift ${c.shift}</span>
                                </div>
                                <button class="btn-delete" onclick="deleteCustomer('${c.name}')">‡∏•‡∏ö</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }

        function addCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            const shift = document.getElementById('newCustomerShift').value;

            if (!name) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'warning'); return; }
            if (customers.some(c => c.name === name)) { showToast('‚ö†Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'warning'); return; }

            customers.push({ name, shift });
            saveCustomers();
            renderManageCustomerList();

            document.getElementById('newCustomerName').value = '';

            showToast(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ "${name}" (Shift ${shift}) ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
        }

        function deleteCustomer(name) {
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö "${name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;

            customers = customers.filter(c => c.name !== name);
            saveCustomers();
            renderManageCustomerList();

            showToast(`üóëÔ∏è ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ "${name}" ‡πÅ‡∏•‡πâ‡∏ß`, 'info');
        }

        function saveCustomers() {
            localStorage.setItem('customerList', JSON.stringify(customers));
        }

        // Close modals when clicking outside
        document.getElementById('customerModal').addEventListener('click', (e) => {
            if (e.target.id === 'customerModal') {
                closeCustomerModal();
            }
        });

        document.getElementById('reportModal').addEventListener('click', (e) => {
            if (e.target.id === 'reportModal') {
                closeReportModal();
            }
        });

        document.getElementById('manageModal').addEventListener('click', (e) => {
            if (e.target.id === 'manageModal') {
                closeManageModal();
            }
        });

        // Initialize on page load
        init();
    </script>
</body>
</html>
