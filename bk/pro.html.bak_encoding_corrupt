<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¸™à¸¡ - Snack Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500;600;700&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff666d;
            --primary-dark: #ea575f;
            --secondary: #34c6c1;
            --accent: #ffe66d;
            --bg-main: #f2f3f5;
            --bg-card: #ffffff;
            --text-dark: #343a40;
            --text-light: #737a84;
            --border: #d9dee4;
            --shadow: 0 1px 0 rgba(0,0,0,0.04);
            --shadow-hover: 0 6px 14px rgba(0,0,0,0.08);
            --success: #00b894;
            --warning: #f0b249;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255,107,107,0.03) 0%, transparent 45%),
                radial-gradient(circle at 80% 80%, rgba(52,198,193,0.03) 0%, transparent 45%);
            animation: none;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 30px 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Mitr', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .header-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .date-display {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            box-shadow: 0 4px 15px rgba(78,205,196,0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78,205,196,0.4);
        }

        .btn-outline {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--border);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 22px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 22px;
            background: linear-gradient(180deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        .snack-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(138px, 1fr));
            gap: 16px;
        }

        .snack-item {
            background: #f7f8fa;
            border: 2px solid #cfd7de;
            border-radius: 16px;
            padding: 14px 12px 12px;
            cursor: pointer;
            transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            min-height: 180px;
        }

        .snack-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .snack-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
            border-color: var(--primary);
        }

        .snack-item:hover::before {
            transform: scaleX(1);
        }

        .snack-item:active {
            transform: translateY(0);
        }

        .snack-emoji {
            font-size: 2.8rem;
            margin-bottom: 8px;
            display: block;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.12));
            animation: bounce 0.5s ease;
        }

        .snack-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 8px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.12));
        }

        .snack-item:hover .snack-img {
            animation: bounce 0.5s ease infinite;
        }

        .snack-img-preview {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 8px;
        }

        .snack-img-modal {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 10px;
        }

        .snack-img-mini {
            width: 24px;
            height: 24px;
            object-fit: cover;
            border-radius: 4px;
            vertical-align: middle;
        }

        .image-upload-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-clipboard {
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            color: var(--text-dark);
            font-family: 'Prompt', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .btn-clipboard:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .image-upload-wrapper input[type="file"] {
            display: none;
        }

        .image-drop-zone {
            width: 80px;
            height: 52px;
            border: 2px dashed var(--border);
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-family: 'Prompt', sans-serif;
            font-size: 0.75rem;
            color: var(--text-light);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .image-drop-zone:hover, .image-drop-zone.drag-over {
            border-color: var(--primary);
            color: var(--primary);
            background: #FFF5F5;
        }

        .image-drop-zone.has-image {
            border-color: var(--success);
            border-style: solid;
            padding: 0;
        }

        .image-drop-zone.has-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .image-drop-zone .drop-icon {
            font-size: 1.2rem;
            line-height: 1;
        }

        .image-drop-zone .drop-text {
            font-size: 0.65rem;
            line-height: 1;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .snack-item:hover .snack-emoji {
            animation: bounce 0.5s ease infinite;
        }

        .snack-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-dark);
        }

        .snack-price {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 24px;
            padding: 35px;
            max-width: 900px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: scaleIn 0.3s ease-out;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.6rem;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            background: var(--bg-main);
            color: var(--primary);
            transform: rotate(90deg);
        }

        .price-display {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #FFF5F5, #FFE5E5);
            border-radius: 12px;
            border: 2px solid #FFD1D1;
        }

        .price-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .price-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Mitr', sans-serif;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }

        .customer-section-title {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .customer-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 5px;
        }

        .customer-btn {
            padding: 14px 16px;
            background: linear-gradient(135deg, #f5f7fa, #ffffff);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 1rem;
            text-align: center;
            font-family: 'Prompt', sans-serif;
        }

        .customer-btn:hover {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            border-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78,205,196,0.3);
        }

        .customer-btn.selected {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
        }

        .customer-btn {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }

        .customer-btn.selected {
            justify-content: space-between;
            padding: 8px 10px;
        }

        .qty-btn {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .qty-btn-minus {
            background: rgba(255,255,255,0.4);
            color: white;
        }

        .qty-btn-minus:hover {
            background: rgba(255,255,255,0.7);
            color: var(--primary);
        }

        .qty-btn-plus {
            background: rgba(255,255,255,0.4);
            color: white;
        }

        .qty-btn-plus:hover {
            background: rgba(255,255,255,0.7);
            color: var(--success);
        }

        .qty-display {
            font-weight: 700;
            font-size: 1rem;
            min-width: 24px;
            text-align: center;
        }

        .shift-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .shift-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            font-family: 'Prompt', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shift-btn:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .shift-btn.active {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            border-color: var(--secondary);
        }

        .customer-name-label {
            flex: 1;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #00A077);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,184,148,0.4);
            z-index: 3000;
            animation: slideInFromRight 0.4s ease-out;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .summary-card {
            background: linear-gradient(135deg, var(--secondary), #3FBDB5);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
        }

        .summary-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .summary-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .summary-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Mitr', sans-serif;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 20px;
            border-radius: 16px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Mitr', sans-serif;
            color: var(--primary);
        }

        .customer-detail-list {
            margin-top: 20px;
        }

        .customer-detail-item {
            background: linear-gradient(to right, #f8f9fa, #ffffff);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            margin-bottom: 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .customer-detail-item:hover {
            background: linear-gradient(to right, #ffffff, #f8f9fa);
            transform: translateX(4px);
            box-shadow: var(--shadow);
        }

        .customer-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .customer-detail-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .customer-detail-total {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        .customer-detail-info {
            color: var(--text-light);
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .qr-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            header {
                flex-direction: column;
                gap: 15px;
                padding: 20px;
            }

            .header-info {
                flex-direction: column;
                width: 100%;
            }

            .header-info .btn {
                width: 100%;
            }

            .snack-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }

            .snack-emoji {
                font-size: 2.5rem;
            }

            .snack-name {
                font-size: 0.95rem;
            }

            .card {
                padding: 20px;
            }

            .modal-content {
                padding: 25px 20px;
            }

            .summary-content {
                grid-template-columns: 1fr;
            }

            .customer-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            body {
                padding: 10px;
            }
        }

        .today-purchase-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 8px;
            backdrop-filter: blur(10px);
            font-size: 0.95rem;
        }

        .today-purchase-item .purchase-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .today-purchase-item .purchase-price {
            font-weight: 700;
            white-space: nowrap;
        }

        .today-purchase-item .purchase-time {
            opacity: 0.8;
            font-size: 0.8rem;
        }

        .today-purchase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .today-purchase-header span {
            font-weight: 600;
            font-size: 1rem;
        }

        .manage-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .manage-tab {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: white;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .manage-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }

        .manage-tab:not(.active):hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .manage-list {
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .manage-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f5f7fa, #ffffff);
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .manage-item:hover {
            border-color: var(--primary);
        }

        .manage-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .manage-item-price {
            color: var(--primary);
            font-weight: 600;
        }

        .btn-delete {
            background: none;
            border: 2px solid #FFD1D1;
            border-radius: 8px;
            color: var(--primary);
            cursor: pointer;
            padding: 6px 12px;
            font-size: 0.85rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-delete:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .manage-form {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa, #ffffff);
            border-radius: 16px;
            border: 2px solid var(--border);
        }

        .manage-form input {
            flex: 1;
            min-width: 80px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .manage-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }

        .manage-form .btn {
            white-space: nowrap;
        }

        .snack-stock {
            font-size: 0.85rem;
            margin-top: 6px;
            padding: 2px 10px;
            border-radius: 999px;
            display: inline-block;
            font-weight: 600;
        }

        .snack-stock.in-stock {
            background: #dff8f3;
            color: #00aa8c;
        }

        .snack-stock.low-stock {
            background: #fff1d7;
            color: #dd9b1c;
        }

        .snack-stock.out-of-stock {
            background: #f7e3e6;
            color: #d78790;
        }

        .snack-item.sold-out {
            opacity: 0.52;
            pointer-events: none;
            filter: grayscale(0.5);
        }

        .snack-item.sold-out::after {
            content: 'à¸«à¸¡à¸”';
            position: absolute;
            top: 8px;
            right: 10px;
            background: #e9bfc3;
            color: white;
            font-size: 0.68rem;
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 6px;
        }

        .ranking-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 16px;
            padding: 25px;
            margin-top: 20px;
        }

        .ranking-title {
            font-family: 'Mitr', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .ranking-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.15);
            padding: 12px 16px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .ranking-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .ranking-badge.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .ranking-badge.silver { background: linear-gradient(135deg, #C0C0C0, #A0A0A0); }
        .ranking-badge.bronze { background: linear-gradient(135deg, #CD7F32, #A0522D); }
        .ranking-badge.normal { background: rgba(255,255,255,0.2); }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .ranking-detail {
            font-size: 0.8rem;
            opacity: 0.85;
        }

        .ranking-total {
            font-weight: 700;
            font-size: 1.1rem;
            font-family: 'Mitr', sans-serif;
        }

        .manage-stock-input {
            width: 70px;
            padding: 6px 10px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-family: 'Prompt', sans-serif;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .manage-stock-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(78,205,196,0.15);
        }

        .btn-stock {
            background: none;
            border: 2px solid var(--secondary);
            border-radius: 8px;
            color: var(--secondary);
            cursor: pointer;
            padding: 6px 12px;
            font-size: 0.85rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-stock:hover {
            background: var(--secondary);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease-out;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-card {
            background: white;
            border-radius: 28px;
            padding: 40px;
            max-width: 440px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: scaleIn 0.4s ease-out;
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo-icon {
            font-size: 4rem;
            margin-bottom: 10px;
            display: block;
        }

        .login-logo h2 {
            font-family: 'Mitr', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-logo p {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .login-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .login-tab {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            font-family: 'Prompt', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .login-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: var(--primary);
        }

        .login-tab:not(.active):hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .login-form input {
            padding: 14px 18px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }

        .login-form .btn {
            padding: 14px;
            font-size: 1.05rem;
        }

        .login-message {
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            display: none;
        }

        .login-message.error {
            display: block;
            background: #FFE5E5;
            color: var(--primary);
            border: 2px solid #FFD1D1;
        }

        .login-message.success {
            display: block;
            background: #E8F8F5;
            color: var(--success);
            border: 2px solid #B2F2E8;
        }

        .login-hint {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: -6px;
        }

        .user-greeting {
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 10px 18px;
            border-radius: 12px;
            border: 2px solid var(--border);
        }

        .user-greeting-name {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .btn-logout {
            background: none;
            border: 2px solid #FFD1D1;
            border-radius: 8px;
            color: var(--primary);
            cursor: pointer;
            padding: 6px 14px;
            font-size: 0.85rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-logout:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <div class="login-logo">
                <span class="login-logo-icon">ðŸª</span>
                <h2>Snack Tracker</h2>
                <p>à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¸™à¸¡</p>
            </div>

            <div class="login-tabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
                <button class="login-tab" onclick="switchLoginTab('register')">à¸ªà¸¡à¸±à¸„à¸£à¹ƒà¸«à¸¡à¹ˆ</button>
            </div>

            <!-- Login Form -->
            <div id="loginMessage" class="login-message"></div>

            <div id="loginForm" class="login-form">
                <input type="text" id="loginNameInput" placeholder="à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­ à¸«à¸£à¸·à¸­ à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™" onkeydown="if(event.key==='Enter')loginUser()">
                <button class="btn btn-primary" onclick="loginUser()">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</button>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="login-form" style="display: none;">
                <input type="text" id="registerDisplayName" placeholder="à¸Šà¸·à¹ˆà¸­à¸«à¸¥à¸±à¸ (à¹€à¸Šà¹ˆà¸™ à¸˜à¸™à¸Šà¸´à¸•)" onkeydown="if(event.key==='Enter')document.getElementById('registerAliases').focus()">
                <input type="text" id="registerAliases" placeholder="à¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™/à¸Šà¸·à¹ˆà¸­à¸­à¸·à¹ˆà¸™à¹† à¸„à¸±à¹ˆà¸™à¸”à¹‰à¸§à¸¢ , (à¹€à¸Šà¹ˆà¸™ à¸Šà¸´à¸•, chit)" onkeydown="if(event.key==='Enter')registerUser()">
                <span class="login-hint">* à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™ à¸Šà¸·à¹ˆà¸­à¸­à¸±à¸‡à¸à¸¤à¸© à¸«à¸£à¸·à¸­à¸Šà¸·à¹ˆà¸­à¹€à¸£à¸µà¸¢à¸à¸­à¸·à¹ˆà¸™à¹† à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ login à¹„à¸”à¹‰ à¸„à¸±à¹ˆà¸™à¸”à¹‰à¸§à¸¢à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢ ,</span>
                <button class="btn btn-secondary" onclick="registerUser()">à¸ªà¸¡à¸±à¸„à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>ðŸª à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¸™à¸¡</h1>
            <div class="header-info">
                <div class="user-greeting" id="userGreeting">
                    <span class="user-greeting-name" id="userGreetingName"></span>
                    <button class="btn-logout" onclick="logoutUser()">à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š</button>
                </div>
                <div class="date-display" id="currentDate"></div>
                <button class="btn btn-outline" onclick="showManageModal()">âš™ï¸ à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
                <button class="btn btn-secondary" onclick="showMonthlyReport()">ðŸ“Š à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™</button>
            </div>
        </header>

        <div class="card">
            <h2 class="card-title">à¹€à¸¥à¸·à¸­à¸à¸‚à¸™à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£</h2>
            <div class="snack-grid" id="snackGrid"></div>

            <div class="summary-card">
                <div class="summary-title">ðŸ“‹ à¸ªà¸£à¸¸à¸›à¸§à¸±à¸™à¸™à¸µà¹‰</div>
                <div class="summary-content">
                    <div class="summary-item">
                        <div class="summary-label">à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</div>
                        <div class="summary-value" id="todayCount">0</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">à¸¢à¸­à¸”à¸£à¸§à¸¡</div>
                        <div class="summary-value" id="todayTotal">0 à¸¿</div>
                    </div>
                </div>
                <div id="todayPurchaseList" style="margin-top: 20px;"></div>
            </div>

            <div class="ranking-card" id="rankingCard" style="display: none;">
                <div class="ranking-title">ðŸ† à¸­à¸±à¸™à¸”à¸±à¸šà¸¥à¸¹à¸à¸„à¹‰à¸²à¸‹à¸·à¹‰à¸­à¹€à¸¢à¸­à¸°à¸—à¸µà¹ˆà¸ªà¸¸à¸”</div>
                <div class="ranking-list" id="rankingList"></div>
            </div>
        </div>
    </div>

    <!-- Manage Modal -->
    <div class="modal" id="manageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">âš™ï¸ à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</h3>
                <button class="close-btn" onclick="closeManageModal()">&times;</button>
            </div>

            <div class="manage-tabs">
                <button class="manage-tab active" onclick="switchManageTab('snacks')">ðŸª à¸ªà¸´à¸™à¸„à¹‰à¸²</button>
                <button class="manage-tab" onclick="switchManageTab('customers')">ðŸ‘¥ à¸¥à¸¹à¸à¸„à¹‰à¸²</button>
            </div>

            <!-- Snacks Tab -->
            <div id="manageSnacksTab">
                <div class="manage-form">
                    <div class="image-upload-wrapper">
                        <input type="file" id="newSnackImage" accept="image/*" onchange="previewSnackImage(this)">
                        <div class="image-drop-zone" id="imageDropZone" onclick="document.getElementById('newSnackImage').click()" tabindex="0">
                            <span class="drop-icon">ðŸ“·</span>
                            <span class="drop-text">à¸§à¸²à¸‡/à¹€à¸¥à¸·à¸­à¸à¸£à¸¹à¸›</span>
                        </div>
                        <button type="button" class="btn-clipboard" onclick="pasteImageFromClipboard()">à¸§à¸²à¸‡à¸ˆà¸²à¸ Ctrl+V</button>
                    </div>
                    <input type="text" id="newSnackName" placeholder="à¸Šà¸·à¹ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸²">
                    <input type="number" id="newSnackPrice" placeholder="à¸£à¸²à¸„à¸²" min="1" style="max-width: 100px;">
                    <input type="number" id="newSnackStock" placeholder="à¸ˆà¸³à¸™à¸§à¸™" min="0" style="max-width: 100px;">
                    <button class="btn btn-primary" onclick="addSnack()">+ à¹€à¸žà¸´à¹ˆà¸¡</button>
                </div>
                <div class="manage-list" id="manageSnackList" style="margin-top: 15px;"></div>
            </div>

            <!-- Customers Tab -->
            <div id="manageCustomersTab" style="display: none;">
                <div class="manage-form">
                    <input type="text" id="newCustomerName" placeholder="à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²">
                    <select id="newCustomerShift" style="padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 0.95rem; min-width: 120px;">
                        <option value="A">Shift A</option>
                        <option value="B">Shift B</option>
                        <option value="C">Shift C</option>
                        <option value="D">Shift D</option>
                    </select>
                    <button class="btn btn-primary" onclick="addCustomer()">+ à¹€à¸žà¸´à¹ˆà¸¡</button>
                </div>
                <div class="manage-list" id="manageCustomerList" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <!-- Select Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <span id="selectedSnackEmoji"></span>
                    <span id="selectedSnackName"></span>
                </div>

                <button class="close-btn" onclick="closeCustomerModal()">&times;</button>
            </div>

            <div class="price-display">
                <div class="price-label">à¸£à¸²à¸„à¸²</div>
                <div class="price-value"><span id="selectedSnackPrice"></span> à¸šà¸²à¸—</div>
            </div>

            <div class="search-box">
                <input type="text" 
                       id="customerSearch" 
                       placeholder="ðŸ” à¸„à¹‰à¸™à¸«à¸²à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²..."
                       oninput="filterCustomers()">
            </div>

            <div class="shift-filter" id="shiftFilter">
                <button class="shift-btn active" onclick="filterShift('all')">à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
                <button class="shift-btn" onclick="filterShift('A')">Shift A</button>
                <button class="shift-btn" onclick="filterShift('B')">Shift B</button>
                <button class="shift-btn" onclick="filterShift('C')">Shift C</button>
                <button class="shift-btn" onclick="filterShift('D')">Shift D</button>
            </div>

            <div class="customer-section-title">
                ðŸ“ à¸¥à¸¹à¸à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸„à¸¥à¸´à¸à¹€à¸žà¸·à¹ˆà¸­à¹€à¸¥à¸·à¸­à¸)
            </div>
            <div class="customer-grid" id="customerGrid"></div>

            <div id="confirmSection" style="display: none; margin-top: 20px; padding-top: 15px; border-top: 2px solid var(--border);">
                <div style="text-align: center; margin-bottom: 12px; font-weight: 500; color: var(--text-dark);">
                    à¹€à¸¥à¸·à¸­à¸à¹à¸¥à¹‰à¸§ <span id="selectedCount" style="color: var(--primary); font-weight: 700;">0</span> à¸„à¸™
                </div>
                <button class="btn btn-primary" onclick="confirmPurchase()" style="width: 100%; padding: 16px; font-size: 1.1rem;">
                    âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
                </button>
            </div>
        </div>
    </div>

    <!-- Monthly Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ðŸ“Š à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™</h3>
                <button class="close-btn" onclick="closeReportModal()">&times;</button>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-dark);">
                    à¹€à¸¥à¸·à¸­à¸à¹€à¸”à¸·à¸­à¸™/à¸›à¸µ
                </label>
                <input type="month" 
                       id="reportMonth" 
                       onchange="generateReport()"
                       style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Prompt', sans-serif;">
            </div>

            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        // Default snack items
        const defaultSnacks = [
            { id: 1, name: 'à¸¡à¸²à¸¡à¹ˆà¸²', emoji: 'ðŸœ', price: 7, stock: 50 },
            { id: 2, name: 'à¹‚à¸„à¸„à¸²', emoji: 'ðŸ¥¤', price: 15, stock: 30 },
            { id: 3, name: 'à¸™à¹‰à¸³à¸”à¸·à¹ˆà¸¡', emoji: 'ðŸ’§', price: 7, stock: 100 },
            { id: 4, name: 'à¹€à¸¥à¸¢à¹Œ', emoji: 'ðŸ¥”', price: 20, stock: 40 },
            { id: 5, name: 'à¸›à¸¥à¸²à¸à¸£à¸²à¸š', emoji: 'ðŸŸ', price: 10, stock: 30 },
            { id: 6, name: 'à¸‚à¸™à¸¡à¸›à¸±à¸‡', emoji: 'ðŸž', price: 12, stock: 25 },
            { id: 7, name: 'à¸™à¸¡', emoji: 'ðŸ¥›', price: 15, stock: 20 },
            { id: 8, name: 'à¸à¸²à¹à¸Ÿ', emoji: 'â˜•', price: 25, stock: 30 },
            { id: 9, name: 'à¸Šà¹‡à¸­à¸„à¹‚à¸à¹à¸¥à¸•', emoji: 'ðŸ«', price: 30, stock: 15 },
            { id: 10, name: 'à¹„à¸­à¸¨à¸à¸£à¸µà¸¡', emoji: 'ðŸ¦', price: 35, stock: 10 },
            { id: 11, name: 'à¸„à¸¸à¸à¸à¸µà¹‰', emoji: 'ðŸª', price: 18, stock: 20 },
            { id: 12, name: 'à¸‚à¸™à¸¡à¸­à¸š', emoji: 'ðŸ¥', price: 22, stock: 15 }
        ];

        // Default customer list with shifts
        const defaultCustomers = [
            { name: 'à¹€à¸­', shift: 'A' }, { name: 'à¸šà¸µ', shift: 'A' }, { name: 'à¸‹à¸µ', shift: 'A' },
            { name: 'à¸”à¸µ', shift: 'A' }, { name: 'à¸­à¸µ', shift: 'A' }, { name: 'à¹€à¸­à¸Ÿ', shift: 'A' },
            { name: 'à¸ˆà¸µ', shift: 'A' },
            { name: 'à¹€à¸­à¸Š', shift: 'B' }, { name: 'à¹„à¸­', shift: 'B' }, { name: 'à¹€à¸ˆ', shift: 'B' },
            { name: 'à¹€à¸„', shift: 'B' }, { name: 'à¹à¸­à¸¥', shift: 'B' }, { name: 'à¹€à¸­à¹‡à¸¡', shift: 'B' },
            { name: 'à¹€à¸­à¹‡à¸™', shift: 'B' },
            { name: 'à¹‚à¸­', shift: 'C' }, { name: 'à¸žà¸µ', shift: 'C' }, { name: 'à¸„à¸´à¸§', shift: 'C' },
            { name: 'à¸­à¸²à¸£à¹Œ', shift: 'C' }, { name: 'à¹€à¸­à¸ª', shift: 'C' }, { name: 'à¸—à¸µ', shift: 'C' },
            { name: 'à¸¢à¸¹', shift: 'C' },
            { name: 'à¸§à¸µ', shift: 'D' }, { name: 'à¸”à¸±à¸šà¹€à¸šà¸´à¹‰à¸¥à¸¢à¸¹', shift: 'D' }, { name: 'à¹€à¸­à¹‡à¸à¸‹à¹Œ', shift: 'D' },
            { name: 'à¸§à¸²à¸¢', shift: 'D' }, { name: 'à¹à¸‹à¸”', shift: 'D' }, { name: 'à¸šà¸­à¸¡', shift: 'D' },
            { name: 'à¸™à¸´à¸§', shift: 'D' }
        ];

        // Load from localStorage or use defaults
        let snacks = JSON.parse(localStorage.getItem('snackItems')) || [...defaultSnacks];
        let customers = JSON.parse(localStorage.getItem('customerList')) || [...defaultCustomers];

        let purchases = [];
        let selectedSnack = null;
        let selectedCustomers = {}; // { name: quantity }
        let activeShift = 'all'; // 'all', 'A', 'B', 'C', 'D'

        // === Login System ===
        let users = JSON.parse(localStorage.getItem('snackUsers')) || [];
        let currentUser = null;

        function saveUsers() {
            localStorage.setItem('snackUsers', JSON.stringify(users));
        }

        function checkSession() {
            const savedUserId = localStorage.getItem('snackCurrentUser');
            if (savedUserId) {
                const user = users.find(u => u.id === parseInt(savedUserId));
                if (user) {
                    currentUser = user;
                    showApp();
                    return true;
                }
            }
            showLoginScreen();
            return false;
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.querySelector('.container').style.display = 'none';
            setTimeout(() => {
                const input = document.getElementById('loginNameInput');
                if (input) input.focus();
            }, 300);
        }

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.querySelector('.container').style.display = 'block';
            document.getElementById('userGreetingName').textContent = `à¸ªà¸§à¸±à¸ªà¸”à¸µ ${currentUser.displayName} ðŸ‘‹`;
            initApp();
        }

        function showLoginMessage(text, type = 'error') {
            const msg = document.getElementById('loginMessage');
            msg.textContent = text;
            msg.className = `login-message ${type}`;
            // Auto hide after 4 seconds
            setTimeout(() => { msg.className = 'login-message'; }, 4000);
        }

        function switchLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('loginMessage').className = 'login-message';
            if (tab === 'login') {
                document.querySelectorAll('.login-tab')[0].classList.add('active');
                document.getElementById('loginForm').style.display = 'flex';
                document.getElementById('registerForm').style.display = 'none';
            } else {
                document.querySelectorAll('.login-tab')[1].classList.add('active');
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('registerForm').style.display = 'flex';
            }
        }

        function loginUser() {
            const nameInput = document.getElementById('loginNameInput').value.trim();
            if (!nameInput) {
                showLoginMessage('à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­');
                return;
            }

            const searchName = nameInput.toLowerCase();
            const foundUser = users.find(u =>
                u.aliases.some(alias => alias.toLowerCase() === searchName)
            );

            if (!foundUser) {
                showLoginMessage('à¹„à¸¡à¹ˆà¸žà¸šà¸Šà¸·à¹ˆà¸­à¸™à¸µà¹‰à¹ƒà¸™à¸£à¸°à¸šà¸š à¸à¸£à¸¸à¸“à¸²à¸ªà¸¡à¸±à¸„à¸£à¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¹ˆà¹à¸—à¹‡à¸š "à¸ªà¸¡à¸±à¸„à¸£à¹ƒà¸«à¸¡à¹ˆ"');
                return;
            }

            currentUser = foundUser;
            localStorage.setItem('snackCurrentUser', foundUser.id);
            document.getElementById('loginNameInput').value = '';
            showApp();
            showToast(`à¸ªà¸§à¸±à¸ªà¸”à¸µ ${foundUser.displayName}! ðŸŽ‰`, 'success');
        }

        function registerUser() {
            const displayName = document.getElementById('registerDisplayName').value.trim();
            const aliasesStr = document.getElementById('registerAliases').value.trim();

            if (!displayName) {
                showLoginMessage('à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸«à¸¥à¸±à¸');
                return;
            }

            // Build aliases array: always include displayName + any comma-separated aliases
            const aliases = [displayName];
            if (aliasesStr) {
                aliasesStr.split(',').forEach(a => {
                    const trimmed = a.trim();
                    if (trimmed && !aliases.some(x => x.toLowerCase() === trimmed.toLowerCase())) {
                        aliases.push(trimmed);
                    }
                });
            }

            // Check for duplicate aliases with existing users
            for (const alias of aliases) {
                const conflict = users.find(u =>
                    u.aliases.some(a => a.toLowerCase() === alias.toLowerCase())
                );
                if (conflict) {
                    showLoginMessage(`à¸Šà¸·à¹ˆà¸­ "${alias}" à¸¡à¸µà¸„à¸™à¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§ (${conflict.displayName})`);
                    return;
                }
            }

            const newId = users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1;
            const newUser = { id: newId, displayName, aliases };
            users.push(newUser);
            saveUsers();

            // Auto login
            currentUser = newUser;
            localStorage.setItem('snackCurrentUser', newUser.id);

            document.getElementById('registerDisplayName').value = '';
            document.getElementById('registerAliases').value = '';

            showApp();
            showToast(`à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸š ${displayName}! ðŸŽ‰`, 'success');
        }

        function logoutUser() {
            if (!confirm('à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸šà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?')) return;
            currentUser = null;
            localStorage.removeItem('snackCurrentUser');
            showLoginScreen();
            showToast('à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§', 'info');
        }

        // Update customer ranking
        function updateRanking() {
            if (purchases.length === 0) {
                document.getElementById('rankingCard').style.display = 'none';
                return;
            }

            const customerTotals = {};
            purchases.forEach(p => {
                if (!customerTotals[p.customerName]) {
                    customerTotals[p.customerName] = { total: 0, count: 0 };
                }
                customerTotals[p.customerName].total += p.price;
                customerTotals[p.customerName].count += 1;
            });

            const sorted = Object.entries(customerTotals)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 10);

            if (sorted.length === 0) {
                document.getElementById('rankingCard').style.display = 'none';
                return;
            }

            document.getElementById('rankingCard').style.display = 'block';

            const badgeClasses = ['gold', 'silver', 'bronze'];
            const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];

            document.getElementById('rankingList').innerHTML = sorted.map(([name, data], i) => {
                const badgeClass = i < 3 ? badgeClasses[i] : 'normal';
                const label = i < 3 ? medals[i] : (i + 1);
                return `
                    <div class="ranking-item">
                        <div class="ranking-badge ${badgeClass}">${label}</div>
                        <div class="ranking-info">
                            <div class="ranking-name">${name}</div>
                            <div class="ranking-detail">à¸‹à¸·à¹‰à¸­ ${data.count} à¸„à¸£à¸±à¹‰à¸‡</div>
                        </div>
                        <div class="ranking-total">${data.total} à¸¿</div>
                    </div>
                `;
            }).join('');
        }

        // Initialize the app
        function init() {
            // Check login session first
            if (!checkSession()) return;

            initApp();
        }

        function initApp() {
            updateCurrentDate();
            renderSnackGrid();
            loadPurchases();
            updateTodaySummary();
            updateRanking();
            setupImageUpload();

            // Set default report month to current month
            const today = new Date();
            document.getElementById('reportMonth').value =
                `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        }

        // Update current date display
        function updateCurrentDate() {
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = new Date().toLocaleDateString('th-TH', options);
            document.getElementById('currentDate').textContent = dateStr;
        }

        // Render snack grid
        function renderSnackGrid() {
            const grid = document.getElementById('snackGrid');
            grid.innerHTML = snacks.map(snack => {
                const stock = snack.stock || 0;
                const soldOut = stock <= 0;
                let stockClass = 'in-stock';
                let stockText = `à¹€à¸«à¸¥à¸·à¸­ ${stock}`;
                if (stock <= 0) { stockClass = 'out-of-stock'; stockText = 'à¸«à¸¡à¸”'; }
                else if (stock <= 5) { stockClass = 'low-stock'; stockText = `à¹€à¸«à¸¥à¸·à¸­ ${stock}!`; }

                return `
                    <div class="snack-item ${soldOut ? 'sold-out' : ''}" onclick="${soldOut ? '' : `selectSnack(${snack.id})`}">
                        ${getSnackDisplayHTML(snack, 'grid')}
                        <div class="snack-name">${snack.name}</div>
                        <div class="snack-price">${snack.price} à¸¿</div>
                        <div class="snack-stock ${stockClass}">${stockText}</div>
                    </div>
                `;
            }).join('');
        }

        // Select snack
        function selectSnack(snackId) {
            selectedSnack = snacks.find(s => s.id === snackId);
            selectedCustomers = {};
            activeShift = 'all';

            // Update modal content
            document.getElementById('selectedSnackEmoji').innerHTML = getSnackDisplayHTML(selectedSnack, 'modal');
            document.getElementById('selectedSnackName').textContent = selectedSnack.name;
            document.getElementById('selectedSnackPrice').textContent = selectedSnack.price;

            // Clear search
            document.getElementById('customerSearch').value = '';

            // Hide confirm section
            updateConfirmSection();

            // Render customer grid
            renderCustomerGrid();

            // Show modal
            document.getElementById('customerModal').classList.add('active');

            // Focus on search after modal animation
            setTimeout(() => {
                document.getElementById('customerSearch').focus();
            }, 300);
        }

        // Render customer grid
        function renderCustomerGrid(filter = '') {
            const grid = document.getElementById('customerGrid');
            const filteredCustomers = customers.filter(c => {
                const nameMatch = c.name.toLowerCase().includes(filter.toLowerCase());
                const shiftMatch = activeShift === 'all' || c.shift === activeShift;
                return nameMatch && shiftMatch;
            });

            grid.innerHTML = filteredCustomers.map(c => {
                const name = c.name;
                const qty = selectedCustomers[name] || 0;
                const isSelected = qty > 0;
                if (isSelected) {
                    return `
                        <div class="customer-btn selected" onclick="selectCustomer('${name}')">
                            <button class="qty-btn qty-btn-minus" onclick="event.stopPropagation(); changeQty('${name}', -1)">-</button>
                            <span class="customer-name-label">${name} <strong>(${qty})</strong></span>
                            <button class="qty-btn qty-btn-plus" onclick="event.stopPropagation(); changeQty('${name}', 1)">+</button>
                        </div>
                    `;
                }
                return `
                    <button class="customer-btn" onclick="selectCustomer('${name}')">
                        ${name}
                    </button>
                `;
            }).join('');

            // Update shift button active state
            document.querySelectorAll('.shift-btn').forEach(btn => btn.classList.remove('active'));
            const shiftBtns = document.querySelectorAll('.shift-btn');
            const shiftIndex = ['all', 'A', 'B', 'C', 'D'].indexOf(activeShift);
            if (shiftBtns[shiftIndex]) shiftBtns[shiftIndex].classList.add('active');
        }

        // Filter by shift
        function filterShift(shift) {
            activeShift = shift;
            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
        }

        // Filter customers
        function filterCustomers() {
            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
        }

        // Select customer (first click = qty 1, click again = +1)
        function selectCustomer(name) {
            if (!selectedCustomers[name]) {
                selectedCustomers[name] = 1;
            } else {
                selectedCustomers[name]++;
            }

            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
            updateConfirmSection();
        }

        // Change quantity with +/- buttons
        function changeQty(name, delta) {
            const newQty = (selectedCustomers[name] || 0) + delta;
            if (newQty <= 0) {
                delete selectedCustomers[name];
            } else {
                selectedCustomers[name] = newQty;
            }

            const searchTerm = document.getElementById('customerSearch').value;
            renderCustomerGrid(searchTerm);
            updateConfirmSection();
        }

        // Update confirm section visibility and count
        function updateConfirmSection() {
            const section = document.getElementById('confirmSection');
            const customerCount = Object.keys(selectedCustomers).length;
            const totalQty = Object.values(selectedCustomers).reduce((sum, q) => sum + q, 0);

            if (customerCount > 0) {
                section.style.display = 'block';
                const totalPrice = totalQty * (selectedSnack ? selectedSnack.price : 0);
                document.getElementById('selectedCount').innerHTML =
                    `${customerCount} à¸„à¸™ / ${totalQty} à¸Šà¸´à¹‰à¸™ / à¸£à¸§à¸¡ ${totalPrice} à¸¿`;
            } else {
                section.style.display = 'none';
            }
        }

        // Confirm purchase for all selected customers
        function confirmPurchase() {
            const customerCount = Object.keys(selectedCustomers).length;
            const totalQty = Object.values(selectedCustomers).reduce((sum, q) => sum + q, 0);

            if (customerCount === 0) {
                showToast('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²', 'warning');
                return;
            }

            if (!selectedSnack) {
                showToast('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸‚à¸™à¸¡', 'warning');
                closeCustomerModal();
                return;
            }

            // Check stock
            const snackInList = snacks.find(s => s.id === selectedSnack.id);
            if (!snackInList || snackInList.stock < totalQty) {
                showToast(`âš ï¸ à¸ªà¸´à¸™à¸„à¹‰à¸²à¹€à¸«à¸¥à¸·à¸­à¹„à¸¡à¹ˆà¸žà¸­ (à¹€à¸«à¸¥à¸·à¸­ ${snackInList ? snackInList.stock : 0} à¸Šà¸´à¹‰à¸™, à¸•à¹‰à¸­à¸‡à¸à¸²à¸£ ${totalQty} à¸Šà¸´à¹‰à¸™)`, 'warning');
                return;
            }

            // Create purchase records for each selected customer x quantity
            const now = new Date().toISOString();
            Object.entries(selectedCustomers).forEach(([customerName, qty]) => {
                for (let i = 0; i < qty; i++) {
                    const purchase = {
                        id: Date.now() + Math.random(),
                        customerName: customerName,
                        snack: { ...selectedSnack },
                        price: selectedSnack.price,
                        date: now
                    };
                    purchases.unshift(purchase);
                }
            });

            // Decrease stock
            snackInList.stock -= totalQty;
            saveSnacks();

            savePurchases();
            updateTodaySummary();
            renderSnackGrid();
            updateRanking();

            const names = Object.entries(selectedCustomers).map(([n, q]) => `${n}(${q})`).join(', ');
            showToast(`âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ! ${selectedSnack.name} - ${names}`, 'success');

            closeCustomerModal();
        }

        // Close customer modal
        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('active');
            selectedSnack = null;
            selectedCustomers = {};
        }

        // Update today's summary
        function updateTodaySummary() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const todayPurchases = purchases.filter(p => {
                const purchaseDate = new Date(p.date);
                purchaseDate.setHours(0, 0, 0, 0);
                return purchaseDate.getTime() === today.getTime();
            });

            const count = todayPurchases.length;
            const total = todayPurchases.reduce((sum, p) => sum + p.price, 0);

            document.getElementById('todayCount').textContent = count;
            document.getElementById('todayTotal').textContent = `${total} à¸¿`;

            // Render today's purchase list
            const listContainer = document.getElementById('todayPurchaseList');
            if (todayPurchases.length === 0) {
                listContainer.innerHTML = '';
                return;
            }

            const showCount = 5;
            let html = `<div class="today-purchase-header">
                <span>ðŸ›’ à¸£à¸²à¸¢à¸à¸²à¸£à¸‹à¸·à¹‰à¸­à¸§à¸±à¸™à¸™à¸µà¹‰ (à¸¥à¹ˆà¸²à¸ªà¸¸à¸” ${Math.min(showCount, todayPurchases.length)}/${todayPurchases.length})</span>
            </div>`;

            todayPurchases.slice(0, showCount).forEach(p => {
                const time = new Date(p.date).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                html += `
                    <div class="today-purchase-item">
                        <div class="purchase-info">
                            ${getSnackDisplayHTML(p.snack, 'mini')}
                            <span><strong>${p.customerName}</strong> - ${p.snack.name}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="purchase-time">${time}</span>
                            <span class="purchase-price">${p.price} à¸¿</span>
                        </div>
                    </div>`;
            });

            listContainer.innerHTML = html;
        }

        // Show monthly report modal
        function showMonthlyReport() {
            document.getElementById('reportModal').classList.add('active');
            generateReport();
        }

        // Close report modal
        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        // Generate monthly report
        function generateReport() {
            const reportMonth = document.getElementById('reportMonth').value;
            if (!reportMonth) return;
            
            const [year, month] = reportMonth.split('-').map(Number);
            const monthStart = new Date(year, month - 1, 1);
            const monthEnd = new Date(year, month, 0, 23, 59, 59);
            
            const monthlyPurchases = purchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                return purchaseDate >= monthStart && purchaseDate <= monthEnd;
            });
            
            if (monthlyPurchases.length === 0) {
                document.getElementById('reportContent').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“Š</div>
                        <p>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¹€à¸”à¸·à¸­à¸™à¸™à¸µà¹‰</p>
                    </div>
                `;
                return;
            }

            // Group by customer
            const customerData = {};
            monthlyPurchases.forEach(purchase => {
                if (!customerData[purchase.customerName]) {
                    customerData[purchase.customerName] = {
                        total: 0,
                        count: 0,
                        items: []
                    };
                }
                customerData[purchase.customerName].total += purchase.price;
                customerData[purchase.customerName].count += 1;
                customerData[purchase.customerName].items.push(purchase.snack);
            });
            
            const totalRevenue = monthlyPurchases.reduce((sum, p) => sum + p.price, 0);
            const totalTransactions = monthlyPurchases.length;
            const totalCustomers = Object.keys(customerData).length;
            const avgPerTransaction = Math.round(totalRevenue / totalTransactions);
            
            // Render report
            const reportContent = document.getElementById('reportContent');
            
            reportContent.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">à¸¢à¸­à¸”à¸‚à¸²à¸¢à¸£à¸§à¸¡</div>
                        <div class="stat-value">${totalRevenue} à¸¿</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£</div>
                        <div class="stat-value">${totalTransactions}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">à¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²</div>
                        <div class="stat-value">${totalCustomers}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">à¸„à¹ˆà¸²à¹€à¸‰à¸¥à¸µà¹ˆà¸¢/à¸£à¸²à¸¢à¸à¸²à¸£</div>
                        <div class="stat-value">${avgPerTransaction} à¸¿</div>
                    </div>
                </div>

                <div style="margin-top: 30px;">
                    <h4 style="font-family: 'Mitr', sans-serif; margin-bottom: 15px; color: var(--text-dark); font-size: 1.2rem;">
                        ðŸ’° à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸•à¸²à¸¡à¸¥à¸¹à¸à¸„à¹‰à¸²
                    </h4>
                    <div class="customer-detail-list">
                        ${Object.entries(customerData)
                            .sort((a, b) => b[1].total - a[1].total)
                            .map(([name, data]) => {
                                // Count snack types
                                const snackCounts = {};
                                data.items.forEach(snack => {
                                    snackCounts[snack.name] = (snackCounts[snack.name] || 0) + 1;
                                });
                                const topSnacks = Object.entries(snackCounts)
                                    .sort((a, b) => b[1] - a[1])
                                    .slice(0, 3)
                                    .map(([name, count]) => `${name} (${count})`)
                                    .join(', ');
                                
                                return `
                                    <div class="customer-detail-item">
                                        <div class="customer-detail-header">
                                            <div class="customer-detail-name">${name}</div>
                                            <div class="customer-detail-total">${data.total} à¸¿</div>
                                        </div>
                                        <div class="customer-detail-info">
                                            <span>ðŸ›’ à¸‹à¸·à¹‰à¸­ ${data.count} à¸„à¸£à¸±à¹‰à¸‡</span>
                                            <span>ðŸ“Š à¹€à¸‰à¸¥à¸µà¹ˆà¸¢ ${Math.round(data.total / data.count)} à¸¿/à¸„à¸£à¸±à¹‰à¸‡</span>
                                        </div>
                                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-light);">
                                            <strong>à¸‚à¸™à¸¡à¸—à¸µà¹ˆà¸ªà¸±à¹ˆà¸‡à¸šà¹ˆà¸­à¸¢:</strong> ${topSnacks}
                                        </div>
                                        <div class="qr-container">
                                            <button class="btn btn-secondary" style="width: 100%;" 
                                                    onclick="generateQR('${name}', ${data.total})">
                                                ðŸ”— à¸ªà¸£à¹‰à¸²à¸‡ QR Code à¸ªà¸³à¸«à¸£à¸±à¸šà¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                    </div>
                </div>

                <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px solid var(--border);">
                    <button class="btn btn-outline" onclick="exportReport()" style="width: 100%;">
                        ðŸ“¥ à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸£à¸²à¸¢à¸‡à¸²à¸™ (TXT)
                    </button>
                </div>
            `;
        }

        // Generate QR Code
        function generateQR(customerName, amount) {
            const qrData = `à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¸ªà¸³à¸«à¸£à¸±à¸š: ${customerName}\nà¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™: ${amount} à¸šà¸²à¸—`;
            
            showToast(`ðŸ”— à¸ªà¸£à¹‰à¸²à¸‡ QR Code à¸ªà¸³à¹€à¸£à¹‡à¸ˆ`, 'success');
            
            alert(`QR Code à¸ªà¸³à¸«à¸£à¸±à¸š: ${customerName}\nà¸¢à¸­à¸”à¹€à¸‡à¸´à¸™: ${amount} à¸šà¸²à¸—\n\nà¹ƒà¸™à¸£à¸°à¸šà¸šà¸ˆà¸£à¸´à¸‡ à¸ˆà¸°à¹à¸ªà¸”à¸‡ QR Code à¸—à¸µà¹ˆà¸ªà¹à¸à¸™à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ`);
        }

        // Export report
        function exportReport() {
            const reportMonth = document.getElementById('reportMonth').value;
            if (!reportMonth) return;
            
            const [year, month] = reportMonth.split('-').map(Number);
            const monthStart = new Date(year, month - 1, 1);
            const monthEnd = new Date(year, month, 0, 23, 59, 59);
            
            const monthlyPurchases = purchases.filter(purchase => {
                const purchaseDate = new Date(purchase.date);
                return purchaseDate >= monthStart && purchaseDate <= monthEnd;
            });

            if (monthlyPurchases.length === 0) {
                showToast('âš ï¸ à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¹‰à¸ªà¹ˆà¸‡à¸­à¸­à¸', 'warning');
                return;
            }

            // Create report text
            const monthName = new Date(year, month - 1).toLocaleDateString('th-TH', { year: 'numeric', month: 'long' });
            
            let reportText = `=== à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸£à¸¸à¸›à¸‚à¸™à¸¡ ${monthName} ===\n\n`;
            
            // Group by customer
            const customerData = {};
            monthlyPurchases.forEach(purchase => {
                if (!customerData[purchase.customerName]) {
                    customerData[purchase.customerName] = {
                        total: 0,
                        items: []
                    };
                }
                customerData[purchase.customerName].total += purchase.price;
                customerData[purchase.customerName].items.push({
                    snack: purchase.snack.name,
                    price: purchase.price,
                    date: new Date(purchase.date).toLocaleDateString('th-TH')
                });
            });

            // Add customer details
            Object.entries(customerData)
                .sort((a, b) => b[1].total - a[1].total)
                .forEach(([name, data]) => {
                    reportText += `\n${name}\n`;
                    reportText += `${'='.repeat(name.length)}\n`;
                    reportText += `à¸¢à¸­à¸”à¸£à¸§à¸¡: ${data.total} à¸šà¸²à¸—\n`;
                    reportText += `à¸£à¸²à¸¢à¸à¸²à¸£:\n`;
                    data.items.forEach(item => {
                        reportText += `  - ${item.date}: ${item.snack} (${item.price} à¸šà¸²à¸—)\n`;
                    });
                    reportText += `\n`;
                });

            // Add summary
            const totalRevenue = monthlyPurchases.reduce((sum, p) => sum + p.price, 0);
            reportText += `\n=== à¸ªà¸£à¸¸à¸›à¸£à¸§à¸¡ ===\n`;
            reportText += `à¸¢à¸­à¸”à¸‚à¸²à¸¢à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${totalRevenue} à¸šà¸²à¸—\n`;
            reportText += `à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£: ${monthlyPurchases.length} à¸£à¸²à¸¢à¸à¸²à¸£\n`;
            reportText += `à¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²: ${Object.keys(customerData).length} à¸„à¸™\n`;

            // Create download
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `à¸£à¸²à¸¢à¸‡à¸²à¸™à¸‚à¸™à¸¡_${reportMonth}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showToast('âœ… à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!', 'success');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            if (type === 'warning') {
                toast.style.background = 'linear-gradient(135deg, var(--warning), #F2B84B)';
            } else if (type === 'info') {
                toast.style.background = 'linear-gradient(135deg, var(--secondary), #3FBDB5)';
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInFromRight 0.4s ease-out reverse';
                setTimeout(() => toast.remove(), 400);
            }, 3000);
        }

        // Save purchases to localStorage
        function savePurchases() {
            localStorage.setItem('snackPurchases', JSON.stringify(purchases));
        }

        // Load purchases from localStorage
        function loadPurchases() {
            const saved = localStorage.getItem('snackPurchases');
            if (saved) {
                purchases = JSON.parse(saved);
            }
        }

        // === Manage Modal Functions ===

        function showManageModal() {
            document.getElementById('manageModal').classList.add('active');
            switchManageTab('snacks');
        }

        function closeManageModal() {
            document.getElementById('manageModal').classList.remove('active');
        }

        function switchManageTab(tab) {
            document.querySelectorAll('.manage-tab').forEach(t => t.classList.remove('active'));
            if (tab === 'snacks') {
                document.querySelectorAll('.manage-tab')[0].classList.add('active');
                document.getElementById('manageSnacksTab').style.display = 'block';
                document.getElementById('manageCustomersTab').style.display = 'none';
                renderManageSnackList();
            } else {
                document.querySelectorAll('.manage-tab')[1].classList.add('active');
                document.getElementById('manageSnacksTab').style.display = 'none';
                document.getElementById('manageCustomersTab').style.display = 'block';
                renderManageCustomerList();
            }
        }

        // --- Snack CRUD ---

        // Helper: get snack display HTML (image or emoji fallback)
        function getSnackDisplayHTML(snack, size = 'grid') {
            if (snack.image) {
                const classMap = {
                    'grid': 'snack-img',
                    'manage': 'snack-img-preview',
                    'modal': 'snack-img-modal',
                    'mini': 'snack-img-mini'
                };
                return `<img src="${snack.image}" alt="${snack.name}" class="${classMap[size] || 'snack-img'}">`;
            }
            if (size === 'grid') return `<span class="snack-emoji">${snack.emoji || 'ðŸª'}</span>`;
            if (size === 'manage') return `<span style="font-size: 1.5rem;">${snack.emoji || 'ðŸª'}</span>`;
            if (size === 'modal') return `<span style="font-size: 2rem;">${snack.emoji || 'ðŸª'}</span>`;
            return `<span>${snack.emoji || 'ðŸª'}</span>`;
        }

        // Get snack display name for toast (no HTML)
        function getSnackLabel(snack) {
            return snack.emoji ? `${snack.emoji} ${snack.name}` : snack.name;
        }

        // Preview image when selected in add form
        let pendingSnackImage = null;

        // Process image file (from file input, paste, or drag)
        function processImageFile(file) {
            if (!file || !file.type.startsWith('image/')) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const maxSize = 150;
                    let w = img.width, h = img.height;
                    if (w > h) { if (w > maxSize) { h = h * maxSize / w; w = maxSize; } }
                    else { if (h > maxSize) { w = w * maxSize / h; h = maxSize; } }
                    canvas.width = w;
                    canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    pendingSnackImage = canvas.toDataURL('image/jpeg', 0.7);
                    updateImagePreview();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function updateImagePreview() {
            const dropZone = document.getElementById('imageDropZone');
            if (pendingSnackImage) {
                dropZone.innerHTML = `<img src="${pendingSnackImage}" alt="preview">`;
                dropZone.classList.add('has-image');
            } else {
                dropZone.innerHTML = '<span class="drop-icon">ðŸ“·</span><span class="drop-text">à¸§à¸²à¸‡/à¹€à¸¥à¸·à¸­à¸à¸£à¸¹à¸›</span>';
                dropZone.classList.remove('has-image');
            }
        }

        // From file input
        function previewSnackImage(input) {
            processImageFile(input.files[0]);
        }

        // Setup paste & drag-drop on the drop zone
        function isSnackManageTabActive() {
            const modal = document.getElementById('manageModal');
            const snackTab = document.getElementById('manageSnacksTab');
            return modal && modal.classList.contains('active') && snackTab && snackTab.style.display !== 'none';
        }

        function getImageFromClipboardData(data) {
            if (!data) return null;

            if (data.files && data.files.length > 0) {
                for (const file of data.files) {
                    if (file.type && file.type.startsWith('image/')) return file;
                }
            }

            const items = data.items || [];
            for (const item of items) {
                if (item.type && item.type.startsWith('image/')) {
                    return item.getAsFile();
                }
            }
            return null;
        }

        function handlePasteImageEvent(e) {
            if (!isSnackManageTabActive()) return false;

            const file = getImageFromClipboardData(e.clipboardData);
            if (!file) return false;

            e.preventDefault();
            processImageFile(file);
            showToast('วางรูปจากคลิปบอร์ดสำเร็จ', 'success');
            return true;
        }

        async function pasteImageFromClipboard() {
            if (!isSnackManageTabActive()) {
                showToast('เปิดแท็บสินค้าแล้วลองใหม่', 'warning');
                return;
            }

            if (!navigator.clipboard || !navigator.clipboard.read) {
                showToast('เบราว์เซอร์ไม่รองรับปุ่มนี้ ให้ใช้ Ctrl+V แทน', 'warning');
                return;
            }

            try {
                const clipboardItems = await navigator.clipboard.read();
                for (const item of clipboardItems) {
                    const imageType = item.types.find(t => t.startsWith('image/'));
                    if (!imageType) continue;

                    const blob = await item.getType(imageType);
                    processImageFile(blob);
                    showToast('วางรูปจากคลิปบอร์ดสำเร็จ', 'success');
                    return;
                }
                showToast('ไม่พบรูปในคลิปบอร์ด', 'warning');
            } catch (err) {
                showToast('กด Ctrl+V เพื่อวางรูปแทนปุ่มนี้', 'warning');
            }
        }

        // Setup paste & drag-drop on the drop zone
        function setupImageUpload() {
            const dropZone = document.getElementById('imageDropZone');
            if (!dropZone) return;

            // Catch Ctrl+V globally when manage snack tab is active.
            document.addEventListener('paste', function(e) {
                if (handlePasteImageEvent(e)) e.stopPropagation();
            });

            // Keep support when user pastes inside the modal/drop zone.
            document.getElementById('manageModal').addEventListener('paste', function(e) {
                if (handlePasteImageEvent(e)) e.stopPropagation();
            });

            // Drag & drop
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            dropZone.addEventListener('dragleave', function() {
                dropZone.classList.remove('drag-over');
            });
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                const file = e.dataTransfer?.files[0];
                if (file && file.type.startsWith('image/')) {
                    processImageFile(file);
                    showToast('เพิ่มรูปสำเร็จ', 'success');
                }
            });
        }

        function renderManageSnackList() {
            const list = document.getElementById('manageSnackList');
            if (snacks.length === 0) {
                list.innerHTML = '<div class="empty-state" style="padding: 30px;"><div class="empty-state-icon">ðŸª</div><p>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸™à¸„à¹‰à¸²</p></div>';
                return;
            }
            list.innerHTML = snacks.map(s => `
                <div class="manage-item">
                    <div class="manage-item-info">
                        ${getSnackDisplayHTML(s, 'manage')}
                        <span>${s.name}</span>
                        <span class="manage-item-price">${s.price} à¸¿</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 0.85rem; color: var(--text-light);">à¸„à¸¥à¸±à¸‡:</span>
                        <input type="number" class="manage-stock-input" value="${s.stock || 0}" min="0"
                               onchange="updateStock(${s.id}, this.value)">
                        <button class="btn-stock" onclick="addStock(${s.id}, 10)">+10</button>
                        <button class="btn-delete" onclick="deleteSnack(${s.id})">à¸¥à¸š</button>
                    </div>
                </div>
            `).join('');
        }

        function addSnack() {
            const name = document.getElementById('newSnackName').value.trim();
            const price = parseInt(document.getElementById('newSnackPrice').value);
            const stock = parseInt(document.getElementById('newSnackStock').value) || 0;

            if (!pendingSnackImage) { showToast('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸£à¸¹à¸›à¸ªà¸´à¸™à¸„à¹‰à¸²', 'warning'); return; }
            if (!name) { showToast('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸²', 'warning'); return; }
            if (!price || price <= 0) { showToast('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸£à¸²à¸„à¸²à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡', 'warning'); return; }

            const newId = snacks.length > 0 ? Math.max(...snacks.map(s => s.id)) + 1 : 1;
            snacks.push({ id: newId, name, image: pendingSnackImage, emoji: '', price, stock });
            saveSnacks();
            renderManageSnackList();
            renderSnackGrid();

            // Reset form
            pendingSnackImage = null;
            document.getElementById('newSnackImage').value = '';
            updateImagePreview();
            document.getElementById('newSnackName').value = '';
            document.getElementById('newSnackPrice').value = '';
            document.getElementById('newSnackStock').value = '';

            showToast(`âœ… à¹€à¸žà¸´à¹ˆà¸¡ ${name} à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!`, 'success');
        }

        function updateStock(id, value) {
            const snack = snacks.find(s => s.id === id);
            if (snack) {
                snack.stock = Math.max(0, parseInt(value) || 0);
                saveSnacks();
                renderSnackGrid();
            }
        }

        function addStock(id, amount) {
            const snack = snacks.find(s => s.id === id);
            if (snack) {
                snack.stock = (snack.stock || 0) + amount;
                saveSnacks();
                renderManageSnackList();
                renderSnackGrid();
                showToast(`âœ… à¹€à¸žà¸´à¹ˆà¸¡à¸ªà¸•à¹‡à¸­à¸ ${snack.name} +${amount}`, 'success');
            }
        }

        function deleteSnack(id) {
            const snack = snacks.find(s => s.id === id);
            if (!confirm(`à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸š "${snack.name}" à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?`)) return;

            snacks = snacks.filter(s => s.id !== id);
            saveSnacks();
            renderManageSnackList();
            renderSnackGrid();

            showToast(`ðŸ—‘ï¸ à¸¥à¸š ${snack.name} à¹à¸¥à¹‰à¸§`, 'info');
        }

        function saveSnacks() {
            localStorage.setItem('snackItems', JSON.stringify(snacks));
        }

        // --- Customer CRUD ---

        function renderManageCustomerList() {
            const list = document.getElementById('manageCustomerList');
            if (customers.length === 0) {
                list.innerHTML = '<div class="empty-state" style="padding: 30px;"><div class="empty-state-icon">ðŸ‘¥</div><p>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸¥à¸¹à¸à¸„à¹‰à¸²</p></div>';
                return;
            }
            const shifts = ['A', 'B', 'C', 'D'];
            list.innerHTML = shifts.map(shift => {
                const group = customers.filter(c => c.shift === shift);
                if (group.length === 0) return '';
                return `
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; color: var(--secondary); margin-bottom: 8px; font-size: 0.95rem;">Shift ${shift} (${group.length} à¸„à¸™)</div>
                        ${group.map(c => `
                            <div class="manage-item">
                                <div class="manage-item-info">
                                    <span>ðŸ‘¤</span>
                                    <span>${c.name}</span>
                                    <span style="font-size: 0.8rem; color: var(--text-light); background: #f0f0f0; padding: 2px 8px; border-radius: 6px;">Shift ${c.shift}</span>
                                </div>
                                <button class="btn-delete" onclick="deleteCustomer('${c.name}')">à¸¥à¸š</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }

        function addCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            const shift = document.getElementById('newCustomerShift').value;

            if (!name) { showToast('âš ï¸ à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²', 'warning'); return; }
            if (customers.some(c => c.name === name)) { showToast('âš ï¸ à¸Šà¸·à¹ˆà¸­à¸™à¸µà¹‰à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹à¸¥à¹‰à¸§', 'warning'); return; }

            customers.push({ name, shift });
            saveCustomers();
            renderManageCustomerList();

            document.getElementById('newCustomerName').value = '';

            showToast(`âœ… à¹€à¸žà¸´à¹ˆà¸¡à¸¥à¸¹à¸à¸„à¹‰à¸² "${name}" (Shift ${shift}) à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!`, 'success');
        }

        function deleteCustomer(name) {
            if (!confirm(`à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸š "${name}" à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?`)) return;

            customers = customers.filter(c => c.name !== name);
            saveCustomers();
            renderManageCustomerList();

            showToast(`ðŸ—‘ï¸ à¸¥à¸šà¸¥à¸¹à¸à¸„à¹‰à¸² "${name}" à¹à¸¥à¹‰à¸§`, 'info');
        }

        function saveCustomers() {
            localStorage.setItem('customerList', JSON.stringify(customers));
        }

        // Close modals when clicking outside
        document.getElementById('customerModal').addEventListener('click', (e) => {
            if (e.target.id === 'customerModal') {
                closeCustomerModal();
            }
        });

        document.getElementById('reportModal').addEventListener('click', (e) => {
            if (e.target.id === 'reportModal') {
                closeReportModal();
            }
        });

        document.getElementById('manageModal').addEventListener('click', (e) => {
            if (e.target.id === 'manageModal') {
                closeManageModal();
            }
        });

        // Initialize on page load
        init();
    </script>
</body>
</html>
